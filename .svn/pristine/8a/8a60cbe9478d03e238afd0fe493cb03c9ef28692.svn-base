package kr.or.ddit.ddtown.service.emp.audition;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import kr.or.ddit.ServiceResult;
import kr.or.ddit.ddtown.mapper.emp.audition.IEmpAuditionMapper;
import kr.or.ddit.ddtown.service.file.IFileService;
import kr.or.ddit.vo.corporate.audition.AuditionVO;

@Service
public class EmpAuditionServiceImpl implements IEmpAuditionService {
	
	@Autowired
	private IEmpAuditionMapper empAuditionMapper;
	
	@Autowired
    private IFileService fileService;
	
	private static final String FILETYPECODE = "FITC003";
	
	//오디션 목록
	@Override
	public List<AuditionVO> auditionList() {
		
		List<AuditionVO> auditionList = empAuditionMapper.auditionList();
		System.out.println("리스트" + auditionList);
		return auditionList;
	}
	//오디션일정 상세보기
	@Override
	public AuditionVO detailAudition(int audiNo) {
		return empAuditionMapper.detailAudition(audiNo);
	}
	@Override
	public ServiceResult insertAudition(AuditionVO auditionVO) throws Exception {
		// 파일 업로드 처리 및 파일 그룹 번호 생성
        if (auditionVO.getAudiMemFiles() != null && auditionVO.getAudiMemFiles().length > 0 && !auditionVO.getAudiMemFiles()[0].isEmpty()) {
            // 파일 타입 코드 사용
            Integer fileGroupNo = fileService.uploadAndProcessFiles(auditionVO.getAudiMemFiles(), FILETYPECODE);
            auditionVO.setFileGroupNo(fileGroupNo);
        }else {
        	auditionVO.setFileGroupNo(null);
        }
        
        int status = empAuditionMapper.insertAudition(auditionVO);
        if(status > 0) {
        	 return ServiceResult.OK;	//성공
        }
        	return ServiceResult.FAILED;//실패
		
	}
	//오디션 수정하기
	@Override
	public ServiceResult updateAudition(AuditionVO auditionVO) {
		
		
		return null;
	}

}
