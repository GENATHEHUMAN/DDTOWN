<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.ddit.ddtown.mapper.chat.dm.ChatRoomMapper">
	
	<resultMap type="kr.or.ddit.vo.chat.dm.ChatRoomVO" id="chatRoomMap">
		<id property="chatChannelNo" column="CHAT_CHANNEL_NO"/>
		<result property="comuProfileNo" column="COMU_PROFILE_NO"/>
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="chatTypeCode" column="CHAT_TYPE_CODE"/>
		<result property="chatChannelOpenDate" column="CHAT_CHANNEL_OPEN_DATE"/>
		<result property="chatLastDate" column="CHAT_LAST_DATE"/>
	</resultMap>
	
	<select id="selectAllRooms" resultMap="chatRoomMap">
		select *
		from
				chat_channels
		order by
				chat_channel_open_date desc
	</select>
	
	<select id="selectRoomByChannelNo" parameterType="int" resultMap="chatRoomMap">
		select *
		from
				chat_channels
		where
				chat_channel_no = #{chatChannelNo}
	</select>
	
	<insert id="insertChatRoom" parameterType="kr.or.ddit.vo.chat.dm.ChatRoomVO"
		useGeneratedKeys="true" keyProperty="chatChannelNo">
		<selectKey keyProperty="chatChannelNo" resultType="int" order="BEFORE">
			select chat_channel_no_seq.nextval from dual
		</selectKey>
		insert into chat_channels (
			chat_channel_no
		    , comu_profile_no
		    , art_group_no
		    , chat_type_code
		    , chat_channel_open_date
		    , chat_last_date
		) values (
		 	#{chatChannelNo}
	        , #{comuProfileNo}
	        , #{artGroupNo}
	        , #{chatTypeCode}
	        , sysdate
	        , sysdate
		)
	</insert>
	
	<update id="updateChatLastDate">
		update
				chat_channels
		set
				chat_last_date = #{chatLastDate}
		where
				chat_channel_no = #{chatChannelNo}
	</update>
	
	<delete id="deleteChatRoom" parameterType="int">
		delete from chat_channels
		where chat_channel_no = #{chatChannelNo}
	</delete>
	
 </mapper>