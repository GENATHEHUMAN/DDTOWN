<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>블랙리스트 관리 - DDTOWN 관리자</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style >
.input-group-append {
    display: flex;
}

</style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="emp-content">
                <section id="blacklistListSection" class="ea-section active-section">
                    <div class="ea-section-header">
                        <h2>블랙리스트 회원 관리</h2>
                        <span style="font-size: 0.8em; color: gray;">
            				(블랙리스트 총: ${blacklistCnt != null ? blacklistCnt : 0})
        				</span>
        				<div class="category-buttons">
    <a href="#" class="btn btn-secondary">
        음란물 <span class="badge badge-light">${blacklistReasonCounts.음란물 != null ? blacklistReasonCounts.음란물 : 0}명</span>
    </a>

    <a href="#" class="btn btn-danger">
        욕설 <span class="badge badge-light">${blacklistReasonCounts.욕설 != null ? blacklistReasonCounts.욕설 : 0}명</span>
    </a>

    <a href="#" class="btn btn-warning">
        기타 <span class="badge badge-light">${blacklistReasonCounts.기타 != null ? blacklistReasonCounts.기타 : 0}명</span>
    </a>

    <a href="#" class="btn btn-info">
        사기 <span class="badge badge-light">${blacklistReasonCounts.사기 != null ? blacklistReasonCounts.사기 : 0}명</span>
    </a>
</div>
                        <div class="ea-header-actions">
                        	<form class="input-group input-group-sm" method="get" id="searchForm" style="flex-wrap: nowrap; ">                                      
								<input type="hidden" name="page" id="page"/>
								<select id="searchType" name="searchType" class="ea-filter-select" onchange="this.form.submit();" title="사유 필터">
	                                <option value="all" ${searchType == 'all' ? 'selected' : ''}>전체 유형</option>
	                                <option value="BRC001" ${searchType == 'BRC001' ? 'selected' : ''}>스팸</option>
	                                <option value="BRC002" ${searchType == 'BRC002' ? 'selected' : ''}>욕설</option>
	                                <option value="BRC003" ${searchType == 'BRC003' ? 'selected' : ''}>음란물</option>
	                                <option value="BRC004" ${searchType == 'BRC004' ? 'selected' : ''}>기타</option>
	                            </select>&nbsp;
	                            <select id="searchCode" name="searchCode" class="ea-filter-select" onchange="this.form.submit();" title="상태 필터">
	                                <option value="all" ${searchCode == 'all' ? 'selected' : ''}>전체 상태</option>
	                                <option value="Y" ${searchCode == 'Y' ? 'selected' : ''}>활성</option>
	                                <option value="N" ${searchCode == 'N' ? 'selected' : ''}>비활성</option>
	                            </select>&nbsp;
                            	<input type="text" class="ea-search-input" name="searchWord" id="blacklistSearchInput" placeholder="회원 검색">
                            	<div class="input-group-append">
									<button type="submit" id="memberSearchButton" class="ea-btn primary" style="width:60px;" >검색</button>
									<button type="button" id="resetSearchButton" class="ea-btn" style="width:70px; margin-left: 5px;">초기화</button>
								</div>
                            </form>	
                        	                        	
                        </div>
                        
                    </div>

                    <table class="ea-table">
                        <thead>
                            <tr>
                                <th class="col-number">번호</th>
                                <th class="col-userId">회원</th>
                                <th class="col-reason">블랙리스트 사유</th>
                                <th class="col-blacklisted-date">지정일</th>
                                <th class="col-banDate">기간</th>
                                <th class="col-blacklisted-date">담당자</th>
                                <th class="col-blacklisted-date">차단 여부</th>
                            </tr>
                        </thead>
                        <tbody id="blacklistTableBody">
                        	<c:forEach items="${blackList }" var="black">
	                        	<tr data-blacklist-id="BL001" data-user-id="troublemaker">
	                                <td>${black.banNo }</td>
	                                <td class="col-userId">
	                                	<a href="/admin/community/blacklist/detail?banNo=${black.banNo }" class="member-id-link">${black.memUsername }</a>
	                                </td>
	                                <td class="col-reason">
	                                	<c:choose>
			                       			<c:when test="${black.banReasonCode eq 'BRC001'}">스팸</c:when>
			                       			<c:when test="${black.banReasonCode eq 'BRC002'}">욕설</c:when>
			                       			<c:when test="${black.banReasonCode eq 'BRC003'}">음란물</c:when>
			                       			<c:when test="${black.banReasonCode eq 'BRC004'}">기타</c:when>
			                       		</c:choose>
	                                </td>
	                                <td>
	                                	<c:set value="${fn:split(black.banRegDate, ' ')}" var="banRegDate"/>
	                                	${banRegDate[0]}</td>
	                                <td>
	                                	<c:set value="${fn:split(black.banStartDate, ' ')}" var="banStartDate"/>
		                       				<c:set value="${fn:split(black.banEndDate, ' ')}" var="banEndDate"/>
		                       				${banStartDate[0]} ~ ${banEndDate[0]}
	                                </td>
	                                <td>${black.empUsername }</td>
 	                                <td>
	                                	<c:choose>
			                       			<c:when test="${black.banActYn eq 'N'}">비활성</c:when>
			                       			<c:when test="${black.banActYn eq 'Y'}">활성</c:when>
			                       		</c:choose>
	                                </td>
	                            </tr>
                        	</c:forEach>
                        	<c:if test="${empty blackList}">
				                <tr>
				                    <td colspan="9">신고 내역이 없습니다.</td>
				                </tr>
				            </c:if>
                        </tbody>
                    </table>
                    <div class="ea-pagination" id="pagingArea">
                    	${pagingVO.pagingHTML }
                    </div>
                    <div style="text-align: right; margin-top: 10px;">
                    	<a class="ea-btn primary" href="/admin/community/blacklist/form" id="accountAddButton"  style="width:90px;"><i class="fas fa-plus"></i> 등록 </a>
					</div>
                </section>
            </main>
        </div>
    </div>
<%@ include file="../../modules/footerPart.jsp" %>

<%@ include file="../../modules/sidebar.jsp" %>     
<script>
//사이드바 메뉴 기능
$(function(){

	let pagingArea = $("#pagingArea");	//페이징 영역
	let searchForm = $("#searchForm");	//검색 Form 태그 Element			
	

   	 // 페이지네이션 로직

	 $(document).on('click', '.page-link', function(e) {
	        e.preventDefault(); // 기본 링크 동작(href="#") 방지

	        var page = $(this).data('page'); // data-page 속성 값 가져오기
	        
	        if (page) { // page 값이 유효한 경우에만 실행
	            $('#page').val(page); // hidden input #page의 값을 설정
	            $('#searchForm').submit(); // 검색 폼 제출
	        }
	    });
	 $('#resetSearchButton').on('click', function() {
	        // 검색 필드 값 초기화
	        $('#searchType').val('all');   // 신고 유형 '전체 유형'으로
	        $('#searchCode').val('all');   // 처리 상태 '전체 상태'로
	        $('#reportSearchInput').val(''); // 검색어 입력 필드 비움
	        $('#page').val(1);             // 페이지를 1페이지로 초기화

	        // 폼 제출
	        $('#searchForm').submit();
	    });
})
  document.addEventListener('DOMContentLoaded', function() {
      
   	// 페이지네이션 로직
      const pagingArea = $('#pagingArea');
      if(pagingArea.length > 0) {
          pagingArea.on('click', 'a', function(event) { 
              event.preventDefault();
              const page = $(this).data('page');
              
              // 현재 URL에서 검색 파라미터 유지
              const currentSearchUrl = new URL(window.location.href);
              const searchType = currentSearchUrl.searchParams.get("searchType");
              const searchWord = currentSearchUrl.searchParams.get("searchWord");

              let targetPageUrl = '${pageContext.request.contextPath}/emp/artist/artist-management?page=' + page;

              if (searchType && searchWord) {
                  targetPageUrl += '&searchType=' + encodeURIComponent(searchType);
                  targetPageUrl += '&searchWord=' + encodeURIComponent(searchWord);
              }
              window.location.href = targetPageUrl;
          });
      }
  });

    $(function(){
        <c:if test="${not empty message}">
        var message = "${message}"; // 컨트롤러에서 넘어온 message 값을 JavaScript 변수에 할당

        if (typeof swal === 'function') {
            swal({
                title: "알림",
                text: message,
                icon: "success",
                button: "확인",
            });
        }
    </c:if>
    });
</script>
</body>
</html> 