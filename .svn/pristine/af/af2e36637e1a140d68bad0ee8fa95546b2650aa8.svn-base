<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.ddtown.mapper.goods.IGoodsMapper">
	
	<!-- 상품 목록 -->
 	<select id="goodsList" resultType="kr.or.ddit.vo.goods.goodsVO">
		select
			goods_no,
			art_group_no,
			goods_stat_code,
			file_group_no,
			goods_nm,
			goods_price,
			goods_content,
			goods_reg_date,
			goods_mod_date,
			goods_code,
			goods_multi_opt_yn
		from goods
		order by goods_no desc
 	</select>
 	
 	<!-- 상품 한 개씩 가져오기 -->
 	<select id="getGoodsDetail" resultType="kr.or.ddit.vo.goods.goodsVO">
 		select
 			goods_no,
			art_group_no,
			goods_stat_code,
			file_group_no,
			goods_nm,
			goods_price,
			goods_content,
			goods_reg_date,
			goods_mod_date,
			goods_code,
			goods_multi_opt_yn
		from goods
		where goods_no = #{goodsNo}
 	</select>
 	
 	<!-- 상품 옵션 가져오기 -->
 	<select id="optionList" resultType="kr.or.ddit.vo.goods.goodsOptionVO">
 		select
 			goods_opt_no, 
 			goods_no, 
 			goods_opt_nm, 
 			goods_opt_fix_yn, 
 			goods_opt_etc, 
 			goods_opt_sec, 
 			goods_opt_price
 		from goods_option
 		where goods_no = #{goodsNo}
 	</select>
 	
 	<!--  상품 상태 가져오기 -->
 	<select id="getgoodsStatus" resultType="kr.or.ddit.vo.goods.goodsVO">
		select
			g.goods_no,
			g.goods_nm,
			g.goods_stat_code,
			cdc.comm_code_det_nm as status_eng_key,
			cdc.description as status_kor_name
		from
			goods g
		inner join
			common_detail_code cdc on g.goods_stat_code = cdc.comm_code_det_no
		where cdc.comm_code_grp_no = 'GOODS_STAT_CODE'
 	</select>
 	
 	<!-- 상품별 총 재고 수량 가져오기 -->
 	<select id="getgoodsTotalStock" resultType="kr.or.ddit.vo.goods.goodsStockVO">
 		select
 			goods_no as goodsNo,
 			coalesce(sum(stock_remain_qty),0) as totalStockQty
 		from
 			goods_stock
 		group by
 			goods_no	
 	</select>
 	
 	<!-- 새 상품 등록 -->
 	<insert id="itemsRegister" parameterType="kr.or.ddit.vo.goods.goodsVO">
		INSERT INTO GOODS (
			goods_no, 
			art_group_no, 
			goods_stat_code, 
			file_group_no, 
			goods_nm, 
			goods_price,
			goods_content, 
			goods_reg_date, 
			goods_mod_date, 
			goods_code,
			goods_multi_opt_yn 
		) VALUES (
			#{goodsNo}, 
			#{artGroupNo, jdbcType=NUMERIC}, 
			#{goodsStatCode, jdbcType=VARCHAR},
			#{fileGroupNo, jdbcType=NUMERIC}, 
			#{goodsNm, jdbcType=VARCHAR},
			#{goodsPrice, jdbcType=NUMERIC}, 
			#{goodsContent, jdbcType=CLOB},
			SYSDATE, 
			SYSDATE, 
			#{goodsCode, jdbcType=VARCHAR}, 
			#{goodsMultiOptYn, jdbcType=CHAR} 
		)
	</insert>
 	
 	<!-- 굿즈 옵션 정보 삽입 -->
 	<insert id="insertGoodsOption" parameterType="kr.or.ddit.vo.goods.goodsOptionVO">
 		<selectKey keyProperty="goodsOptNo" resultType="int" order="BEFORE">
 			select GOODS_OPTION_SEQ.NEXTVAL FROM DUAL
 		</selectKey>
 		insert into GOODS_OPTION (
			goods_opt_no,
	        goods_no,
	        goods_opt_nm,
	        goods_opt_price,
	        goods_opt_fix_yn,
	        goods_opt_etc,
	        goods_opt_sec
 		) values (
 			#{goodsOptNo, jdbcType=NUMERIC},
 			#{goodsNo, jdbcType=NUMERIC},
 			#{goodsOptNm, jdbcType=VARCHAR},
 			#{goodsOptPrice, jdbcType=NUMERIC},
 			#{goodsOptFixYn, jdbcType=CHAR}, 
        	#{goodsOptEtc, jdbcType=VARCHAR},
        	#{goodsOptSec, jdbcType=NUMERIC}
 		)	
 	</insert>
 	
 	<!-- 상품 재고 삽입 -->
 	<insert id="insertGoodsStock" parameterType="kr.or.ddit.vo.goods.goodsStockVO">
 		<selectKey keyProperty="stockNo" resultType="int" order="BEFORE">
 			select GOODS_STOCK_SEQ.NEXTVAL FROM DUAL
 		</selectKey>
	 	insert into GOODS_STOCK (
			stock_no,
			goods_opt_no,
			stock_type_code,
			goods_no,
			stock_safe_qty,
			stock_remain_qty,
			stock_new_qty,
			stock_unit_cost,
			stock_mod_date
	 	) values (
			#{stockNo},   
	        #{goodsOptNo, jdbcType=NUMERIC},
	        #{stockTypeCode, jdbcType=VARCHAR},   
	        #{goodsNo, jdbcType=NUMERIC},
	        #{stockSafeQty, jdbcType=NUMERIC},    
	        #{stockRemainQty, jdbcType=NUMERIC},   
	        #{stockNewQty, jdbcType=NUMERIC},     
	        #{stockUnitCost, jdbcType=NUMERIC},   
	        SYSDATE                            
	 	)
 	</insert>
 	
 	<!-- 아티스트 그룹 가져오기 -->
 	<select id="selectAllArtistGroups" resultType="kr.or.ddit.vo.artist.ArtistGroupVO">
 		select 
 			art_group_no,
 			art_group_nm
 		from
 			artist_group where 
 			art_group_del_yn = 'N' 
 		order by 
 			art_group_nm ASC 
 	</select>
 	
 	<select id="selectNextGoodsNo" resultType="int">
 		select goods_seq.nextval from dual
 	</select>
 </mapper>