<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.ddit.ddtown.mapper.audition.AuditionMapper">
 
 	<resultMap type="kr.or.ddit.vo.corporate.audition.AuditionVO" id="auditionMap">
 		<id property="audiNo" column="audi_no"/>
 		<result property="audiNo" column="audi_no"/>
 		<result property="empUsername" column="emp_username"/>
 		<result property="audiTypeCode" column="audi_type_code"/>
 		<result property="audiStatCode" column="audi_stat_code"/>
 		<result property="fileGroupNo" column="file_group_no"/>
 		<result property="audiTitle" column="audi_title"/>
 		<result property="audiContent" column="audi_content"/>
 		<result property="audiStartDate" column="audi_start_date"/>
 		<result property="audiEndDate" column="audi_end_date"/>
 		<result property="audiRegDate" column="audi_reg_date"/>
 		<result property="audiModDate" column="audi_mod_date"/>
 	</resultMap>
 
 	<select id="auditionList" resultType="kr.or.ddit.vo.corporate.audition.AuditionVO">
 		select AUDI_NO, EMP_USERNAME, AUDI_TYPE_CODE, AUDI_STAT_CODE, FILE_GROUP_NO, AUDI_TITLE, 
 			   AUDI_CONTENT, AUDI_START_DATE, AUDI_END_DATE, AUDI_REG_DATE, AUDI_MOD_DATE
 		from AUDITION
 		order by audi_no desc
 	</select>
 	
 	<select id="detailAudition" parameterType="int" resultMap="auditionMap">
 		select AUDI_NO, EMP_USERNAME, AUDI_TYPE_CODE, AUDI_STAT_CODE, FILE_GROUP_NO, AUDI_TITLE, 
 			   AUDI_CONTENT, AUDI_START_DATE, AUDI_END_DATE, AUDI_REG_DATE, AUDI_MOD_DATE
 		from AUDITION
 		where AUDI_NO = #{audiNo}
 	</select>
 	
 	<select id="emailCheck" parameterType="kr.or.ddit.vo.corporate.audition.AuditionUserVO" resultType="kr.or.ddit.vo.corporate.audition.AuditionUserVO">
 		select *
 		from audition_application
 		where audi_no = #{audiNo} and applicant_email = #{applicantEmail} 
 	</select>
 	
 	<!-- 
	APSC001	지원 완료
	APSC002	합격
	APSC003	불합격 	
 	 -->
 	<insert id="signup" parameterType="kr.or.ddit.vo.corporate.audition.AuditionUserVO">
 		<selectKey keyProperty="appNo" resultType="int" order="BEFORE">
            SELECT NVL(MAX(APP_NO),0)+1 FROM AUDITION_APPLICATION
        </selectKey>
        insert into AUDITION_APPLICATION(
        	APP_NO, AUDI_NO, APP_STAT_CODE, FILE_GROUP_NO, APPLICANT_NO, APPLICANT_NM, APPLICANT_BIRTH, 
        	APPLICANT_GENDER, APPLICANT_PHONE, APPLICANT_EMAIL, APP_COVER_LETTER, APP_REG_DATE, APPLICANT_AGREE
        )values(
        	#{appNo}, #{audiNo}, 'APSC001', #{fileGroupNo}
        	, (SELECT #{audiTypeCode} || '_' || TRIM(TO_CHAR((COUNT(*)+1),'000')) FROM AUDITION_APPLICATION WHERE AUDI_NO = #{audiNo})
        	, #{applicantNm}, #{applicantBirth}, 
        	#{applicantGender}, #{applicantPhone}, #{applicantEmail}, #{appCoverLetter}, SYSDATE, #{applicantAgree}
        )
 	</insert>
 
 </mapper>