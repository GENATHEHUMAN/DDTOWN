<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<%@ taglib uri="jakarta.tags.core"  prefix="c"%>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ì˜ í”„ë¡œí•„</title>
<%@ include file="../../modules/headerPart.jsp" %>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/my_profile.css">
</head>

<body>
    
	<header class="site-header">
    <div class="logo">
      <a href="artist_community_main.html">DDTOWN SQUARE</a>
    </div>
    <nav class="utility-nav">
      <ul id="loggedOutNav">
        <li><a href="#" id="loginBtn" class="auth-link">ë¡œê·¸ì¸</a></li>
        <li><a href="signup.html" class="signup-link">íšŒì›ê°€ì…</a></li>
      </ul>
      <ul id="loggedInNav" style="display: none">
        <li><a href="#" id="notificationBtn" class="icon-btn" title="ì•Œë¦¼">ğŸ””</a></li>
        <li><a href="#" id="myPageBtn" class="icon-btn" title="ë§ˆì´í˜ì´ì§€">ğŸ‘¤</a></li>
        <li><a href="#" class="icon-btn" title="ì»¬ë ‰ì…˜">ğŸŒŸ</a></li>
        <li><a href="#" class="icon-btn special-icon" title="ìŠ¤í˜ì…œ">J</a></li>
        <li><a href="#" class="icon-btn" title="ë”ë³´ê¸°">ğŸ›ï¸</a></li>
        <li><a href="#" id="logoutBtn" class="auth-link">ë¡œê·¸ì•„ì›ƒ</a></li>
      </ul>
    </nav>
  </header>
  <nav class="main-navigation">
    <ul>
      <li><a href="#">êµ¿ì¦ˆìƒµ</a></li>
      <li>
        <a href="preference_vote.html">ì„ í˜¸ë„ ì¡°ì‚¬</a>
        <ul class="submenu">
          <li><a href="preference_vote.html" style="color: #8a2be2; font-weight:bold;">ì¸ê¸° íˆ¬í‘œ</a></li>
        </ul>
      </li>
    </ul>
  </nav>
  
  <main class="profile-main">
    <header class="profile-header">
      <div class="profile-header-inner">
        <div class="profile-avatar">
          <img src="${profileVO.comuProfileImg}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
        </div>
        <div class="profile-nickname" id="profileNickname">${profileVO.comuNicknm}</div>
      </div>
    </header>
    <nav class="profile-tabs">
      <button class="tab active" data-tab="posts">í¬ìŠ¤íŠ¸</button>
      <button class="tab" data-tab="comments">ëŒ“ê¸€</button>
    </nav>
    <section class="profile-tab-content" id="postsTab" style="display:block;">
    	<c:choose>
    		<c:when test="${empty profileVO.postList}">
		      <div class="no-content">ì•„ì§ ì‘ì„±í•œ í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    		</c:when>
    		<c:otherwise>
    			<c:forEach items="${profileVO.postList}" var="post">
    				<div class="post-card">
			            <div class="post-header">
			                <span class="category">[ììœ ê²Œì‹œíŒ]</span>
			                <span class="post-date">2023.01.01</span>
			            </div>
			            <div class="post-media">
			                <img src="[ë‚´ ê¸€ì˜ ëŒ€í‘œ ì´ë¯¸ì§€ URL]" alt="ë‚´ê°€ ì“´ ê¸€ ì´ë¯¸ì§€" class="post-thumbnail">
			            </div>
			            <div class="post-content-area">
			                <h4 class="post-title">ë‚´ê°€ ì“´ ê¸€ì˜ ë©‹ì§„ ì œëª©ì…ë‹ˆë‹¤.</h4>
			                <p class="post-preview">ê¸€ ë‚´ìš©ì˜ ì¼ë¶€ë¥¼ ë¯¸ë¦¬ ë³´ì—¬ì¤ë‹ˆë‹¤. ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ ì˜ë¼ì£¼ì„¸ìš”...</p>
			            </div>
			            <div class="post-meta-bottom">
			                <span class="post-likes">â¤ï¸ 123</span>
			                <span class="post-comments">ğŸ’¬ 45</span>
			                <span class="post-views">ğŸ‘€ 678</span>
			            </div>
			        </div>
    			</c:forEach>
    		</c:otherwise>
    	</c:choose>
    </section>
    <section class="profile-tab-content" id="commentsTab" style="display:none;">
    	<c:choose>
    		<c:when test="${empty profileVO.replyList}">
		      <div class="no-content">ì•„ì§ ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    		</c:when>
    		<c:otherwise>
    			<c:forEach items="${profileVO.replyList}" var="reply">
    				<div class="comment-list-item">
			            <div class="comment-content mb-3 detailBox" style="cursor:pointer;" data-comu-post-no="${reply.comuPostNo}">
			            	<div class="d-flex align-items-center">
			                	<span>
				                   <img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFwSURBVHgB7ZfLbYNAEIYHjMQBIbkEUkFIBcEduIS4AofHhRs3LjziCpIS3EFwBaGDUIKvSDwyI2HJWmMbAka2tN+BXcTM7L8DK/0AcO4U4dwDz/PmqqquBUEw8NaAYaR1XW9s2/6CPkJ839dkWf7GqQbjkuV5vnBdN4MuQqIo+m1EZNiRFY6paZp7+CdxHC+xI/FRzRe2nsgmhWH4xiQkQ0QQmL+lWlSTaldV9c7GnAjBhDWNGGwOFcCI2ZdluWrWeL0qBNHp4jjOFkZGkqS0mRrQQcjNuNThSYVc4m6ESH2Cj451FzLLsp46xj5oR/rssC/8Y2Xhp4aFnxoW/rGynBWCrmoOE9ImJKFLURQ6jEwQBMtmmsI1IegtdzTOZrPPMbtCfwWiKMbNGhv2+Yl5psUx8Aca30qWcYhbIwGKoui0sUPNttPX6uJRjIZibvI7gX51gU4tgy5CDpCjx0Ry3M8wjB1uLMFX8zGmIedMwh+5vYcq7uc6lQAAAABJRU5ErkJggg==" width="15px" height="15px">
			                	</span>
			                	${reply.comuPostContent}
			            	</div>
			                <hr/>
			                <p class="">
			                    ${reply.comuReplyContent}
			                </p>
			            </div>
			        </div>
    			</c:forEach>
    		</c:otherwise>
    	</c:choose>
    </section>
  </main>

  <div id="footer-placeholder"></div>
  <div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content" style="border-radius: 20px;">
        
        <div class="modal-header modal-post-header border-bottom-0">
          <div class="d-flex align-items-center">
            <a href="#user-profile">
              <img id="postUserImg" src="" class="rounded-circle profile-img" alt="í”„ë¡œí•„">
            </a>
            <div class="ms-3">
              <a href="#user-profile" class="text-decoration-none text-dark">
                <strong class="fw-bold" id="postUserNm"></strong>
                </a>
              <div class="text-muted small" id="postRegDate"></div>
            </div>
          </div>
          <div class="d-flex align-items-center">
             <button class="btn btn-light btn-sm me-2" type="button"><i class="bi bi-three-dots-vertical"></i></button>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
        </div>

        <div class="modal-body py-4" id="postContent">
        </div>
        
        <div class="modal-footer flex-column align-items-stretch border-top-0">
          <div class="d-flex justify-content-start align-items-center gap-3 w-100 mb-3">
            <button type="button" class="btn btn-light">
              <i class="bi bi-emoji-smile"></i> ì‘ì›í•˜ê¸° <span class="badge bg-secondary ms-1">14</span>
            </button>
            <button type="button" class="btn btn-light">
              <i class="bi bi-share"></i> ê³µìœ 
            </button>
          </div>

          <div class="w-100">
             <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">0ê°œì˜ ëŒ“ê¸€</h6>
                <button class="btn btn-sm btn-light"><i class="bi bi-arrow-clockwise"></i></button>
             </div>
             
             <div class="text-center text-muted p-4" id="replyContentDiv">
               ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤
             </div>

             <div class="input-group mt-3 modal-comment-input">
               <textarea class="form-control" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." aria-label="ëŒ“ê¸€ ì…ë ¥" rows="1"></textarea>
               <button class="btn btn-outline-secondary" type="button" disabled>ë“±ë¡</button>
             </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <%@ include file="../../modules/footerPart.jsp" %>
</body>
<script type="text/javascript">
// íƒ­ ì „í™˜
document.querySelectorAll('.profile-tabs .tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.profile-tabs .tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('postsTab').style.display = this.dataset.tab === 'posts' ? 'block' : 'none';
    document.getElementById('commentsTab').style.display = this.dataset.tab === 'comments' ? 'block' : 'none';
  });
});


$(function(){
	const postModal = $("#postModal"); // í•´ë‹¹ í¬ìŠ¤íŠ¸ í˜¹ì€ ëŒ“ê¸€ì´ë‹¬ë¦° ì›ë³¸ê¸€ì„ ë³´ì—¬ì¤„ ëª¨ë‹¬
	const detailBox = $(".detailBox"); // ìì‹ ì´ ì“´ ê¸€ì´ë‚˜ ëŒ“ê¸€ div
	detailBox.on("click",function(){
		let comuPostNo = $(this).data("comuPostNo");
	
		
		$.ajax({
			url : "/api/community/getPost?comuPostNo="+comuPostNo,
			type : "get",
			success : function(res){
				console.log(res);
				let {writerProfile} = res;
				$("#postUserImg").attr("src",writerProfile.comuProfileImg);
				$("#postUserNm").html(writerProfile.comuNicknm);
				$("#postRegDate").html(getFormattedDate(res.comuPostRegDate));
				$("#postContent").html(res.comuPostContent);
				//$("#replyContentDiv") // ëŒ“ê¸€ ì˜ì—­
			},
			error : function(err){
				console.log(err);
			}
		})
		
		postModal.modal("show");
	})
	
	
	function padTwoDigits(num) {
	  return num.toString().padStart(2, "0");
	}

	function getFormattedDate(time) {
	  const date = new Date(time);

	  return (
	    [
	      date.getFullYear(),
	      padTwoDigits(date.getMonth() + 1),
	      padTwoDigits(date.getDate()),
	    ].join(".") +
	    " " +
	    [
	      padTwoDigits(date.getHours()),
	      padTwoDigits(date.getMinutes())
	    ].join(":")
	  );
	}
})
</script>
</html>