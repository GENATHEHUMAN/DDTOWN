<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 전자결재 - 결재 문서 리스트</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/approval_draft_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="approval-content">
                <div class="approval-title">결재 문서함</div>
                <div class="approval-list-search-row" style="display:flex; gap:8px; justify-content: flex-end; align-items: center; margin-bottom:18px;">
                	<form>
                    <select id="approval-status-filter" name="searchType" class="approval-search-input" style="height:40px; border-radius:5px; border:1px solid #ccc; font-size:1em;">
                        <option value="all">전체 상태</option> 
                        <option value="ESC001" <c:if test="${pagingVO.searchType eq 'ESC001' }">selected</c:if>>대기</option>
                        <option value="ESC002" <c:if test="${pagingVO.searchType eq 'ESC002' }">selected</c:if>>진행</option>
                        <option value="ESC003" <c:if test="${pagingVO.searchType eq 'ESC003' }">selected</c:if>>승인</option>
                        <option value="ESC004" <c:if test="${pagingVO.searchType eq 'ESC004' }">selected</c:if>>반려</option>
                        <option value="ESC005" <c:if test="${pagingVO.searchType eq 'ESC005' }">selected</c:if>>회수</option>
                    </select>
                    <input type="text" id="searchWord" name="searchWord" value="${pagingVO.searchWord}" class="approval-search-input" placeholder="검색 (제목, 작성자...)" style="width:220px; height:40px; border-radius:5px; border:1px solid #ccc; padding:0 12px; font-size:1em;">
                    <button type="submit" id="approval-search-btn" class="ea-btn primary" style="height:36px; min-width:70px;"><i class="fas fa-search"></i> 검색</button>
                	</form>
                </div>
                <div class="approval-list-table-wrap">
                    <table class="approval-list-table">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>제목</th>
                                <th>기안자</th>
                                <th>기안일</th>
                                <th>결재상태</th>
                                <th>PDF</th>
                            </tr>
                        </thead>
                        <tbody id="approval-list-tbody">
                        	<c:choose>
                        		<c:when test="${pagingVO.dataList ne null }">
		                            <c:forEach items="${pagingVO.dataList}" var="approval">
		                            	<tr>
			                            	<td>${approval.rnum}</td>
			                                <td style="text-align: left">${approval.edmsTitle}</td>
			                                <td>${approval.empName}</td>
			                                <td><fmt:formatDate value="${approval.edmsReqDate}" pattern="yyyy/MM/dd" type="date" /> </td>
			                                <td>
			                                	<c:if test="${approval.edmsStatCode eq 'ESC001'}">
			                                		<span style="background:#818681;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">대기</span>
			                                	</c:if>
			                                	<c:if test="${approval.edmsStatCode eq 'ESC002'}">
			                                		<span style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">진행</span>
			                                	</c:if>
			                                	<c:if test="${approval.edmsStatCode eq 'ESC003'}">
			                                		<span style="background:#007bff;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">승인</span>
			                                	</c:if>
			                                	<c:if test="${approval.edmsStatCode eq 'ESC004'}">
			                                		<span style="background:#b71c1c;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">반려</span>
			                                	</c:if>
			                                	<c:if test="${approval.edmsStatCode eq 'ESC005'}">
			                                		<span style="background:#ec841a;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">회수</span>
			                                	</c:if>
											</td>
			                                <td><button class="approval-btn" onclick="window.open('pdf_viewer.html?edmsNo=${approval.edmsNo}','_blank')"><i class="fas fa-file-pdf"></i> PDF</button></td>
			                             </tr>
		                            </c:forEach>
                        		</c:when>
                        		<c:otherwise>
                        			<tr><td colspan="6" style="text-align:center;">검색 결과가 없습니다.</td></tr>
                        		</c:otherwise>
                        	</c:choose>
                        </tbody>
                    </table>
                    <div class="approval-pagination" id="approval-pagination">
                    	${pagingVO.pagingHTML }
                    </div>
                </div>
            </main>
        </div>
        <footer class="emp-footer">
            <p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (직원 전용)</p>
        </footer>
    </div>
</body>
<script>
        // 사이드바 토글 및 활성화 스크립트 (emp_portal.html과 동일하게)
        document.addEventListener('DOMContentLoaded', function() {
            const navItemsWithSubmenu = document.querySelectorAll('.emp-sidebar .emp-nav-item.has-submenu');
            navItemsWithSubmenu.forEach(item => {
                const arrow = item.querySelector('.submenu-arrow');
                item.addEventListener('click', function(event) {
                    event.preventDefault();
                    const parentLi = this.parentElement;
                    const submenu = this.nextElementSibling;
                    if (submenu && submenu.classList.contains('emp-submenu')) {
                        const parentUl = parentLi.parentElement;
                        if (parentUl) {
                            Array.from(parentUl.children).forEach(siblingLi => {
                                if (siblingLi !== parentLi) {
                                    const siblingSubmenuControl = siblingLi.querySelector('.emp-nav-item.has-submenu.open');
                                    if (siblingSubmenuControl) {
                                        const siblingSubmenu = siblingSubmenuControl.nextElementSibling;
                                        siblingSubmenuControl.classList.remove('open');
                                        if (siblingSubmenu && siblingSubmenu.classList.contains('emp-submenu')) {
                                            siblingSubmenu.style.display = 'none';
                                        }
                                        const siblingArrow = siblingSubmenuControl.querySelector('.submenu-arrow');
                                        if (siblingArrow) siblingArrow.style.transform = 'rotate(0deg)';
                                    }
                                }
                            });
                        }
                    }
                    this.classList.toggle('open');
                    if (submenu && submenu.classList.contains('emp-submenu')) {
                        submenu.style.display = this.classList.contains('open') ? 'block' : 'none';
                        if (arrow) arrow.style.transform = this.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
                    }
                });
            });

            // 현재 페이지 URL 기반으로 사이드바 메뉴 활성화
            const currentFullHref = window.location.href;

            document.querySelectorAll('.emp-sidebar .emp-nav-item[href]').forEach(link => {
                const linkHrefAttribute = link.getAttribute('href');

                if (linkHrefAttribute && linkHrefAttribute !== "#" && currentFullHref.endsWith(linkHrefAttribute)) {
                    link.classList.add('active');

                    let currentActiveElement = link;

                    while (true) {
                        const parentLi = currentActiveElement.parentElement;
                        if (!parentLi) break;

                        const parentSubmenuUl = parentLi.closest('.emp-submenu');

                        if (parentSubmenuUl) {
                            parentSubmenuUl.style.display = 'block';

                            const controllingAnchor = parentSubmenuUl.previousElementSibling;

                            if (controllingAnchor && controllingAnchor.tagName === 'A' && controllingAnchor.classList.contains('has-submenu')) {
                                controllingAnchor.classList.add('active', 'open');
                                const arrow = controllingAnchor.querySelector('.submenu-arrow');
                                if (arrow) {
                                    arrow.style.transform = 'rotate(90deg)';
                                }
                                currentActiveElement = controllingAnchor;
                            } else {
                                break;
                            }
                        } else {
                            break;
                        }
                    }
                }
            });
        });
$(function(){
	
	const approval-status-filter = $("#approval-status-filter"); // 정렬 실렉트박스
	const approval-status-filter = $("#approval-status-filter"); // 검색어
	
	
	function displayList(sortType='all',searchWord=''){
		let url = '${pageContext.request.contextPath}/api/emp/edms/getApprovalList?sortType='+sortType+"&searchWord="+searchWord;
		
		$.ajax({
			url : url,
			type : "get",
			success : function(res){
				console.log(res);
			}
		})
	}
})
    </script>
</html> 