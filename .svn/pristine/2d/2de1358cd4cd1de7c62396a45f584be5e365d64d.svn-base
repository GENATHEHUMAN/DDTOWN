<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 전자결재 - 기안서 상세</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/approval_draft_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="approval-content">
                <div class="approval-detail-wrap" style="max-width:800px;margin:0 auto;">
                    <div class="approval-line-wrap" style="margin-bottom:32px;">
                        <div class="approval-line-title">결재라인</div>
                        <div id="approval-line-box">
                            <div class="approval-line-step">[결재] <span>김결재 팀장</span> <span class="approval-status-badge" id="line-status">대기</span></div>
                        </div>
                    </div>
                    <div class="approval-detail-card" style="background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); padding:32px 28px 24px 28px;">
                        <div class="approval-detail-title" style="font-size:1.4em;font-weight:700;color:#2c3e50;margin-bottom:18px;">기안서 상세 보기: 2025년 하반기 워크샵 개최 품의</div>
                        <div class="approval-detail-row" style="display:flex;gap:18px;margin-bottom:12px;">
                            <div style="flex:1;"><strong>문서번호:</strong> 2025-00123</div>
                            <div style="flex:1;"><strong>긴급도:</strong> <span class="approval-priority-badge" style="background:#e53935;color:#fff;padding:4px 12px;border-radius:16px;">긴급</span></div>
                        </div>
                        <div class="approval-detail-row" style="display:flex;gap:18px;margin-bottom:12px;">
                            <div style="flex:1;"><strong>기안자:</strong> 이기안 사원</div>
                            <div style="flex:1;"><strong>기안일:</strong> 2025-05-10</div>
                        </div>
                        <div class="approval-detail-row" style="margin-bottom:12px;"><strong>제목:</strong> 2025년 하반기 워크샵 개최 품의</div>
                        <div class="approval-detail-row" style="margin-bottom:12px;"><strong>내용:</strong>
                            <div class="approval-detail-content-box" style="background:#f8fafc;border-radius:6px;padding:16px 14px;margin-top:6px;white-space:pre-line;">
2025년 하반기 전사 워크샵 개최를 다음과 같이 품의합니다.

- 목적: 팀워크 향상 및 사기 진작
- 일시: 2025년 10월 12일 ~ 13일 (1박 2일)
- 장소: 강원도 DD 리조트
- 예상 비용: 10,000,000원

세부 계획은 첨부파일 참조 바랍니다.
                            </div>
                        </div>
                        <div class="approval-detail-row" style="margin-bottom:12px;"><strong>참조자:</strong> 최기획 대리</div>
                        <div class="approval-detail-row" style="margin-bottom:12px;"><strong>결재상태:</strong> <span class="approval-status-badge" id="doc-status">결재대기</span></div>
                        <div class="approval-detail-actions" style="display:flex;justify-content:flex-end;gap:12px;margin-top:24px;">
                            <button class="approval-btn submit" id="btn-approve"><i class="fas fa-check"></i> 승인</button>
                            <button class="approval-btn" id="btn-reject" style="background:#e53935;color:#fff;"><i class="fas fa-times"></i> 반려</button>
                        </div>
                    </div>
                </div>
                <!-- 반려 사유 입력 모달 -->
                <div id="reject-modal" class="approval-modal" style="display:none;">
                    <div class="approval-modal-content" style="min-width:400px;max-width:90vw;">
                        <div class="approval-modal-header">
                            <span class="approval-modal-title">반려 사유 입력</span>
                            <button class="approval-modal-close" id="reject-modal-close">&times;</button>
                        </div>
                        <div class="approval-modal-body" style="flex-direction:column;gap:0;">
                            <textarea id="reject-reason" style="width:100%;min-height:80px;resize:vertical;padding:10px 12px;border-radius:6px;border:1.5px solid #ced4da;font-size:1em;" placeholder="반려 사유를 입력하세요 (필수)"></textarea>
                        </div>
                        <div class="approval-modal-footer">
                            <button class="approval-modal-confirm" id="reject-modal-confirm">확인</button>
                            <button class="approval-modal-cancel" id="reject-modal-cancel">취소</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <footer class="emp-footer">
            <p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (직원 전용)</p>
        </footer>
    </div>
</body>
<script>
// 사이드바 토글 및 활성화 스크립트 (emp_portal.html과 동일하게)
document.addEventListener('DOMContentLoaded', function() {
    const navItemsWithSubmenu = document.querySelectorAll('.emp-sidebar .emp-nav-item.has-submenu');
    navItemsWithSubmenu.forEach(item => {
        const arrow = item.querySelector('.submenu-arrow');
        item.addEventListener('click', function(event) {
            event.preventDefault();
            const parentLi = this.parentElement;
            const submenu = this.nextElementSibling;
            if (submenu && submenu.classList.contains('emp-submenu')) {
                const parentUl = parentLi.parentElement;
                if (parentUl) {
                    Array.from(parentUl.children).forEach(siblingLi => {
                        if (siblingLi !== parentLi) {
                            const siblingSubmenuControl = siblingLi.querySelector('.emp-nav-item.has-submenu.open');
                            if (siblingSubmenuControl) {
                                const siblingSubmenu = siblingSubmenuControl.nextElementSibling;
                                siblingSubmenuControl.classList.remove('open');
                                if (siblingSubmenu && siblingSubmenu.classList.contains('emp-submenu')) {
                                    siblingSubmenu.style.display = 'none';
                                }
                                const siblingArrow = siblingSubmenuControl.querySelector('.submenu-arrow');
                                if (siblingArrow) siblingArrow.style.transform = 'rotate(0deg)';
                            }
                        }
                    });
                }
            }
            this.classList.toggle('open');
            if (submenu && submenu.classList.contains('emp-submenu')) {
                submenu.style.display = this.classList.contains('open') ? 'block' : 'none';
                if (arrow) arrow.style.transform = this.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
            }
        });
    });

    // 현재 페이지 URL 기반으로 사이드바 메뉴 활성화
    const currentFullHref = window.location.href;

    document.querySelectorAll('.emp-sidebar .emp-nav-item[href]').forEach(link => {
        const linkHrefAttribute = link.getAttribute('href');

        if (linkHrefAttribute && linkHrefAttribute !== "#" && currentFullHref.endsWith(linkHrefAttribute)) {
            link.classList.add('active');

            let currentActiveElement = link;

            while (true) {
                const parentLi = currentActiveElement.parentElement;
                if (!parentLi) break;

                const parentSubmenuUl = parentLi.closest('.emp-submenu');

                if (parentSubmenuUl) {
                    parentSubmenuUl.style.display = 'block';

                    const controllingAnchor = parentSubmenuUl.previousElementSibling;

                    if (controllingAnchor && controllingAnchor.tagName === 'A' && controllingAnchor.classList.contains('has-submenu')) {
                        controllingAnchor.classList.add('active', 'open');
                        const arrow = controllingAnchor.querySelector('.submenu-arrow');
                        if (arrow) {
                            arrow.style.transform = 'rotate(90deg)';
                        }
                        currentActiveElement = controllingAnchor;
                    } else {
                        break;
                    }
                } else {
                    break;
                }
            }
        }
    });
});
	//승인/반려 버튼 동작
	const approveBtn = document.getElementById('btn-approve');
	const rejectBtn = document.getElementById('btn-reject');
	const docStatus = document.getElementById('doc-status');
	const lineStatus = document.getElementById('line-status');
	// 반려 모달
	const rejectModal = document.getElementById('reject-modal');
	const rejectModalClose = document.getElementById('reject-modal-close');
	const rejectModalCancel = document.getElementById('reject-modal-cancel');
	const rejectModalConfirm = document.getElementById('reject-modal-confirm');
	const rejectReason = document.getElementById('reject-reason');
	approveBtn.addEventListener('click', function() {
	    if(confirm('해당 기안서를 승인하시겠습니까?')) {
	        docStatus.textContent = '승인됨';
	        docStatus.style.background = '#4caf50';
	        docStatus.style.color = '#fff';
	        lineStatus.textContent = '승인';
	        lineStatus.style.background = '#4caf50';
	        lineStatus.style.color = '#fff';
	        approveBtn.disabled = true;
	        rejectBtn.disabled = true;
	    }
	});
	rejectBtn.addEventListener('click', function() {
	    rejectModal.style.display = 'flex';
	    rejectReason.value = '';
	});
	function closeRejectModal() {
	    rejectModal.style.display = 'none';
	}
	rejectModalClose.addEventListener('click', closeRejectModal);
	rejectModalCancel.addEventListener('click', closeRejectModal);
	rejectModalConfirm.addEventListener('click', function() {
	    const reason = rejectReason.value.trim();
	    if(!reason) {
	        alert('반려 사유를 입력해야 합니다.');
	        rejectReason.focus();
	        return;
	    }
	    docStatus.textContent = '반려됨';
	    docStatus.style.background = '#b71c1c';
	    docStatus.style.color = '#fff';
	    lineStatus.textContent = '반려';
	    lineStatus.style.background = '#b71c1c';
	    lineStatus.style.color = '#fff';
	    approveBtn.disabled = true;
	    rejectBtn.disabled = true;
	    closeRejectModal();
	    alert('반려 처리되었습니다.');
	});
	window.addEventListener('click', function(event) {
	    if (event.target === rejectModal) {
	        closeRejectModal();
	    }
	});
    </script>
</html> 