<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>아티스트 관리</title>
<style>
    /* 그룹 관리 CSS와 동일하게 적용 */
    body {
        font-family: sans-serif;
    }
    main.emp-content {
        width: 90%;
        margin: 20px auto;
    }
    .artist-search-box {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
    }
    .artist-search-box input[type="text"] {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        flex-grow: 1;
    }
    .artist-search-box button {
        padding: 8px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .artist-search-box button:hover {
        background-color: #0056b3;
    }
    table.artist-table { /* 테이블 클래스명 artist-table로 변경 */
        width: 100%; /* 테이블 너비를 100%로 조정 */
        border-collapse: collapse;
        margin: 20px 0; /* 상하 마진만 적용 */
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px; /* 패딩 증가 */
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
        font-weight: bold; /* 헤더 폰트 굵게 */
    }
    .action-button { /* 수정 버튼 등에 공통적으로 사용할 수 있는 스타일 */
        padding: 6px 12px;
        background-color: #28a745; /* 초록색 계열 */
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
    }
    .action-button:hover {
        background-color: #218838;
    }
    .modal-actions {
        text-align: right;
        margin-top: 20px;
    }

    /* 모달 스타일 (그룹 관리에서 가져옴) */
    .modal {
        display: none; /* 기본적으로 숨김 */
        position: fixed; /* 화면에 고정 */
        z-index: 1000; /* 다른 요소들 위에 표시 */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; /* 스크롤 가능하도록 */
        background-color: rgba(0, 0, 0, 0.4); /* 반투명 배경 */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto; /* 수직/수평 중앙 정렬 (상단에서 10%) */
        padding: 25px; /* 패딩 증가 */
        border: 1px solid #888;
        width: 50%; /* 모달 너비 조정 */
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0
            rgba(0, 0, 0, 0.19);
        border-radius: 5px;
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close-button:hover, .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-content hr {
        margin-top: 5px;
        margin-bottom: 15px;
    }

    .modal-content p {
        margin-bottom: 12px; /* 간격 조정 */
    }
    .modal-content input[type="text"],
    .modal-content textarea { /* 입력 필드 스타일 공통화 */
        width: calc(100% - 16px); /* 패딩 고려한 너비 */
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-top: 4px;
    }
    .modal-content textarea {
        resize: vertical; /* 세로 크기만 조절 가능 */
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <main class="emp-content">
        <h2>아티스트 개별 관리</h2>

        <%-- 아티스트 검색 영역 --%>
        <div class="artist-search-box">
            <input type="text" id="artist-search-input" placeholder="아티스트명으로 검색...">
            <button type="button" id="artist-search-btn"><i class="fas fa-search"></i> 검색</button>
        </div>

        <%-- 아티스트 목록 테이블 --%>
        <c:if test="${not empty artistList}">
            <table class="artist-table">
                <thead>
                    <tr>
                        <th>아티스트 번호</th>
                        <th>아티스트명</th>
                        <th>최근 수정일</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody id="artist-table-body">
                    <c:forEach items="${artistList }" var="artist">
                        <tr>
                            <td>${artist.artNo }</td>
                            <td><c:out value="${artist.artNm }"/></td>
                            <td>
                                <fmt:formatDate value="${artist.artModDate }" pattern="yyyy-MM-dd HH:mm:ss" var="formattedModDate"/>
                                <c:out value="${formattedModDate}"/>
                            </td>
                            <td>
                                <button class="action-button edit-artist-btn"
                                        data-artist-no="${artist.artNo}"
                                        data-artist-nm="<c:out value='${artist.artNm}'/>"
                                        data-artist-mod-date="${formattedModDate}"
                                        data-artist-content="<c:out value='${artist.artContent}' escapeXml='true'/>">수정</button>
                            </td>
                        </tr>
                    </c:forEach>
                </tbody>
            </table>
        </c:if>
        <c:if test="${empty artistList}">
            <p style="text-align: center;">등록된 아티스트가 없습니다.</p>
        </c:if>
    </main>

    <%-- 아티스트 수정 모달 --%>
    <div id="editArtistModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>아티스트 정보 수정</h2>
            <hr>
            <input type="hidden" id="modalArtistNo" name="artNo">
            <p>
                <strong>아티스트 번호:</strong> <span id="displayArtistNo"></span>
            </p>
            <p>
                <strong>아티스트명:</strong>
                <input type="text" id="modalArtistName" name="artNm">
            </p>
            <p>
                <strong>최근 수정일:</strong> <span id="displayArtistModDate"></span>
            </p>
            <%-- 필요하다면 여기에 아티스트의 다른 필드들을 추가 (예: 소개, 프로필 이미지 URL 등) --%>
            <p>
                <strong>소개글:</strong>
            </p>
            <textarea id="modalArtistContent" name="artContent" rows="4"></textarea>
            <%--
            <p>
                <strong>프로필 이미지 URL:</strong>
                <input type="text" id="modalArtistProfileImg" name="artProfileImg">
            </p>
            --%>
            <div class="modal-actions">
                <button type="button" class="action-button" id="saveArtistChangesBtn">저장</button>
            </div>
        </div>
    </div>

<script>
$(function() {
    const $editArtistModal = $('#editArtistModal');
    const $closeButton = $editArtistModal.find('.close-button');

    // 모달 필드
    const $modalArtistNoInput = $('#modalArtistNo'); 
    const $displayArtistNo = $('#displayArtistNo'); 
    const $modalArtistName = $('#modalArtistName');
    const $displayArtistModDate = $('#displayArtistModDate');
    const $modalArtistContent = $('#modalArtistContent');
    // const $modalArtistProfileImg = $('#modalArtistProfileImg'); // 예시 필드

    // '수정' 버튼 클릭 시 모달 열기 및 데이터 채우기
    $('#artist-table-body').on('click', '.edit-artist-btn', function() {
        const $button = $(this);
        const artNo = $button.data('artist-no');
        const artNm = $button.data('artist-nm');
        const artModDate = $button.data('artist-mod-date');
        const artContent = $button.data('artist-content');
        // const artProfileImg = $button.data('artist-profileimg');


        // 모달 필드 채우기
        $modalArtistNoInput.val(artNo);
        $displayArtistNo.text(artNo); // 화면 표시용
        $modalArtistName.val(artNm);
        $displayArtistModDate.text(artModDate); // 화면 표시용
        $modalArtistContent.val(artContent);
        // $modalArtistProfileImg.val(artProfileImg || '');

        $editArtistModal.css('display', 'block');
    });

    // 모달 닫기 (X 버튼)
    $closeButton.on('click', function() {
        $editArtistModal.css('display', 'none');
    });

    // 모달 외부 클릭 시 닫기
    $(window).on('click', function(event) {
        if ($(event.target).is($editArtistModal)) {
            $editArtistModal.css('display', 'none');
        }
    });

    // '저장' 버튼 이벤트 (실제 저장 로직은 여기에 AJAX 등으로 구현해야 합니다)
    $('#saveArtistChangesBtn').on('click', function() {
        const artistData = {
            artNo: $modalArtistNoInput.val(),
            artNm: $modalArtistName.val(),
            artContent: $modalArtistContent.val()
            // artProfileImg: $modalArtistProfileImg.val(), // 예시 필드
            // CSRF 토큰이 필요하다면 추가
            // '${_csrf.parameterName}': '${_csrf.token}'
        };

        console.log("저장할 아티스트 데이터:", artistData);
        alert('저장 버튼 클릭됨! 콘솔에서 전송될 데이터를 확인하세요.');

        // TODO: 여기에 AJAX를 사용하여 서버로 데이터를 전송하는 로직을 추가합니다.
        // 예시:
        /*
        $.ajax({
            url: '${pageContext.request.contextPath}/admin/artist/update', // 실제 저장 요청을 처리할 서버 URL
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(artistData),
            // CSRF 헤더 추가 (Spring Security 사용 시)
            // beforeSend : function(xhr) {
            //     xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
            // },
            success: function(response) {
                alert('아티스트 정보가 성공적으로 저장되었습니다.');
                $editArtistModal.hide();
                location.reload(); // 페이지 새로고침하여 변경사항 확인
            },
            error: function(xhr, status, error) {
                console.error("저장 실패:", status, error, xhr.responseText);
                alert('아티스트 정보 저장에 실패했습니다. 서버 로그를 확인해주세요.\n오류: ' + (xhr.responseJSON ? xhr.responseJSON.message : xhr.responseText));
            }
        });
        */
        $editArtistModal.hide(); // 임시로 모달 숨김
    });

    // 검색 버튼 기능 (기본적인 alert만, 실제 검색 로직 필요)
    $('#artist-search-btn').on('click', function() {
        const searchTerm = $('#artist-search-input').val();
        alert('검색어: ' + searchTerm + '\n실제 검색 로직은 여기에 구현해야 합니다.');
        // TODO: 검색 로직 구현 (예: AJAX 요청으로 서버에서 검색 결과 받아오기)
    });
});
</script>
</body>
</html>