package kr.or.ddit.ddtown.controller.admin.group;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import kr.or.ddit.ddtown.service.admin.artist.IAdminArtistService;
import kr.or.ddit.ddtown.service.admin.group.IAdminArtistGroupService;
import kr.or.ddit.vo.PaginationInfoVO;
import kr.or.ddit.vo.artist.AlbumVO;
import kr.or.ddit.vo.artist.ArtistGroupVO;
import kr.or.ddit.vo.artist.ArtistVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/admin/community/group")
public class AdminArtistGroupController {
	
	@Autowired
	private IAdminArtistGroupService artistGroupService;
	
	@Autowired
	private IAdminArtistService artistService;
	
	@GetMapping("/list")
	public String artistGroupList(
			@RequestParam(name = "currentPage", defaultValue = "1", required = true) int currentPage,
			@RequestParam(name = "searchWord",required = false) String searchWord,Model model) {

		PaginationInfoVO<ArtistGroupVO> pagingVO = new PaginationInfoVO<>();
		pagingVO.setCurrentPage(currentPage);
		int totalRecord = artistGroupService.getTotalRecord(pagingVO);
		pagingVO.setTotalRecord(totalRecord);
		List<ArtistGroupVO> groupList = artistGroupService.getGroupList(pagingVO);
		for(ArtistGroupVO groupVO : groupList) {
			List<ArtistVO> artistVO = artistService.getArtistListByGroupNo(groupVO.getArtGroupNo());			
			groupVO.setArtistList(artistVO);
		}
		pagingVO.setDataList(groupList);
		model.addAttribute("pagingVO", pagingVO);
		
		return "admin/group/groupList";
	}
	
	@GetMapping("/detail")
	public String artistGroupDetail(@RequestParam int artGroupNo, Model model) {
		// 그룹 VO 정보 아티스트VO 정보 앨범리스트
		ArtistGroupVO artistGroupVO = artistGroupService.getGroupDetail(artGroupNo);
		model.addAttribute("artistGroupVO", artistGroupVO);
		return "admin/group/groupDetail";
	}
	
	@GetMapping("/update")
	public String artistGroupUpdateForm(@RequestParam int artGroupNo, Model model) {
		ArtistGroupVO artistGroupVO = artistGroupService.getGroupDetail(artGroupNo);
		List<ArtistVO> artistList = artistService.getArtistListAll();
		List<AlbumVO> albumList = artistGroupService.getAlbumListAll(); 
		model.addAttribute("status", "U");
		model.addAttribute("artistGroupVO", artistGroupVO);
		model.addAttribute("artistList", artistList);
		model.addAttribute("albumList", albumList);
		return "admin/group/groupForm";
	}
	
	@GetMapping("/form")
	public String artistGroupForm() {
		return "admin/group/groupForm";
	}
}
