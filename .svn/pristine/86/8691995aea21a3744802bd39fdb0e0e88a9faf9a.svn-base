<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist A - ì»¤ë®¤ë‹ˆí‹°</title>
	<%@ include file="../../modules/headerPart.jsp" %>
	<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
	<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
    <style>
        .membership-blur {
            filter: blur(5px);
            pointer-events: none;
        }
        
        .membership-only {
            position: relative;
        }
        
        .membership-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        
        .membership-badge {
            background: #8a2be2;
            color: #fff;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <!-- <header class="site-header">
        <div class="logo">
            <a href="../2.main/artist_community_main.html">DDTOWN SQUARE</a>
        </div>
        <nav class="utility-nav">
            <ul id="loggedOutNav">
                <li><a href="#" id="loginBtn" class="auth-link">ë¡œê·¸ì¸</a></li>
                <li><a href="signup.html" class="signup-link">íšŒì›ê°€ì…</a></li>
            </ul>
            <ul id="loggedInNav" style="display: none">
                <li>
                  <a href="#" id="notificationBtn" class="icon-btn" title="ì•Œë¦¼">ğŸ””</a>
                </li>
                <li>
                  <a href="#" id="myPageBtn" class="icon-btn" title="ë§ˆì´í˜ì´ì§€">ğŸ‘¤</a>
                </li>
                <li>
                  <a href="#" class="icon-btn" title="ê³ ê°ì„¼í„°">ğŸ‘©â€ğŸ’»</a>
                </li>
                <li><a href="#" id="logoutBtn" class="auth-link">ë¡œê·¸ì•„ì›ƒ</a></li>
              </ul>
        </nav>
        <div class="account-switch" style="margin-top:10px; text-align:right;">
            <button id="switchToArtist" style="margin-right:5px;">ì•„í‹°ìŠ¤íŠ¸ ê³„ì •</button>
            <button id="switchToFan">íŒ¬ ê³„ì •</button>
        </div>
    </header> -->
    <<!-- nav class="main-navigation">
        <ul>
            <li><a href="#">êµ¿ì¦ˆìƒµ</a></li>
            <li>
                <a href="preference_vote.html">ì„ í˜¸ë„ ì¡°ì‚¬</a>
                <ul class="submenu">
                    <li><a href="preference_vote.html" style="color: #8a2be2; font-weight:bold;">ì¸ê¸° íˆ¬í‘œ</a></li>
                </ul>
            </li>
        </ul>
    </nav> -->

    <div class="apt-main-layout">

        <div class="apt-container">
            <header class="apt-header">
                <div class="apt-header-avatar">
                    <div class="artist-avatar-placeholder">A</div>
                </div>
                <div class="apt-header-info">
                    <h2>Artist A <span style="font-size:0.7em; color: #888;">(ì•„í‹°ìŠ¤íŠ¸)</span></h2>
                    <div class="artist-stats">
                        <span>ë©¤ë²„ 5ëª…</span> &bull; <span id="fanCountForApt">123,456</span> íŒ¬
                    </div>
                </div>
                <div class="apt-header-actions">
                <button class="btn-apt-action following" id="followToggleBtn">
                    <span class="follow-icon">âœ”</span> íŒ”ë¡œì‰ </button>
                <button class="btn-apt-action">ğŸ”” ì•Œë¦¼ ì„¤ì •</button>
            </div>
            </header>

            <nav class="apt-tabs">
                <a href="#" class="tab-item active" data-tab="artistFeed">ì•„í‹°ìŠ¤íŠ¸</a>
                <a href="#" class="tab-item" data-tab="fanFeed">íŒ¬</a>
                <a href="#" class="tab-item" data-tab="live">ë¼ì´ë¸Œ</a>
                <a href="#" class="tab-item" data-tab="schedule">ìŠ¤ì¼€ì¤„</a>
                <a href="#" class="tab-item" data-tab="noticeApt">ê³µì§€ì‚¬í•­</a>
            </nav>

            <main class="apt-content-area">
                <div id="artistFeedContent" class="tab-pane active">
                    <div id="artistFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">
                        <input type="text" id="artistFeedSearchInput" placeholder="ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œê¸€ ê²€ìƒ‰ (ì œëª©/ë‚´ìš©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
                    </div>
                    <div id="artistFeedPostFormWrap"></div>
                    <div id="artistFeedList"></div>
                </div>

                <div id="fanFeedContent" class="tab-pane" style="display: none;">
                    <div id="fanFeedPostFormWrap"></div>
                    <div id="fanFeedList"></div>
                </div>

                <div id="liveContent" class="tab-pane" style="display: none;">
                    <div class="live-controls" id="artistLiveControls" style="margin-bottom: 20px; text-align: right; display: none;">
                        <button class="btn-start-live">ğŸ”´ LIVE ì‹œì‘í•˜ê¸°</button>
                    </div>

                    <section class="live-section now-live">
                        <h3><span class="live-indicator">â—</span> LIVE ON AIR</h3>
                        <div class="live-player-placeholder">
                            <img src="https://via.placeholder.com/760x400/000000/FFFFFF?text=ì‹¤ì‹œê°„+ë¼ì´ë¸Œ+í™”ë©´" alt="ì‹¤ì‹œê°„ ë¼ì´ë¸Œ í™”ë©´">
                            <div class="live-title-overlay">Artist Aì˜ ê¹œì§ ë¼ì´ë¸Œ! ì§€ê¸ˆ ì‹œì²­í•˜ì„¸ìš”!</div>
                        </div>
                        <div class="live-info">
                            <p><strong>Artist A</strong>ë‹˜ì´ ë¼ì´ë¸Œ ë°©ì†¡ ì¤‘ì…ë‹ˆë‹¤.</p>
                            <p>ì‹œì²­ì: <span id="liveViewerCount">1,234</span>ëª…</p>
                        </div>
                    </section>
                    <section class="live-section past-lives">
                        <h3>ë¼ì´ë¸Œ ë‹¤ì‹œë³´ê¸°</h3>
                        <div class="past-live-grid">
                            <div class="past-live-item">
                                <a href="#">
                                    <div class="live-thumbnail-placeholder">
                                        <img src="https://via.placeholder.com/300x170/E6E6FA/000000?text=ë‹¤ì‹œë³´ê¸°+1" alt="ë¼ì´ë¸Œ ë‹¤ì‹œë³´ê¸° 1">
                                        <span class="duration-badge">35:12</span>
                                    </div>
                                    <h4 class="past-live-title">Artist A ì²« ë¼ì´ë¸Œ ë°©ì†¡!</h4>
                                    <p class="past-live-date">2025ë…„ 5ì›” 10ì¼</p>
                                    <p class="past-live-views">ì¡°íšŒìˆ˜ 1.5ë§ŒíšŒ</p>
                                </a>
                            </div>
                            <div class="past-live-item">
                                <a href="#">
                                    <div class="live-thumbnail-placeholder">
                                        <img src="https://via.placeholder.com/300x170/ADD8E6/000000?text=ë‹¤ì‹œë³´ê¸°+2" alt="ë¼ì´ë¸Œ ë‹¤ì‹œë³´ê¸° 2">
                                        <span class="duration-badge">01:12:30</span>
                                    </div>
                                    <h4 class="past-live-title">ì•¨ë²” ì‘ì—…ê¸° ê³µê°œ! (ìŠ¤í¬ì£¼ì˜)</h4>
                                    <p class="past-live-date">2025ë…„ 4ì›” 25ì¼</p>
                                    <p class="past-live-views">ì¡°íšŒìˆ˜ 3.2ë§ŒíšŒ</p>
                                </a>
                            </div>
                            <div class="past-live-item">
                                <a href="#">
                                    <div class="live-thumbnail-placeholder">
                                        <img src="https://via.placeholder.com/300x170/90EE90/000000?text=ë‹¤ì‹œë³´ê¸°+3" alt="ë¼ì´ë¸Œ ë‹¤ì‹œë³´ê¸° 3">
                                        <span class="duration-badge">58:05</span>
                                    </div>
                                    <h4 class="past-live-title">íŒ¬ë“¤ê³¼ì˜ Q&A ì‹œê°„</h4>
                                    <p class="past-live-date">2025ë…„ 4ì›” 1ì¼</p>
                                    <p class="past-live-views">ì¡°íšŒìˆ˜ 2.8ë§ŒíšŒ</p>
                                </a>
                            </div>
                            </div>
                    </section>
                </div>

                <div id="scheduleContent" class="tab-pane" style="display: none;">
                    <div class="calendar-header">
                        <button id="prevMonthBtn">&lt;</button>
                        <h3 id="currentMonthYear">2025ë…„ 5ì›”</h3>
                        <button id="nextMonthBtn">&gt;</button>
                        <button id="todayBtn">Today</button>
                    </div>
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody">
                            <tr>
                                <td class="other-month">27</td><td class="other-month">28</td><td class="other-month">29</td><td class="other-month">30</td>
                                <td>1<div class="event">All Day Event</div></td><td>2</td><td>3</td>
                            </tr>
                            <tr>
                                <td>4</td><td>5</td><td>6<div class="event long-event">Long Event</div></td><td>7</td><td>8</td><td>9</td><td>10<div class="event">Conference</div></td>
                            </tr>
                            <tr>
                                <td>11</td><td>12<div class="event">Conference</div><div class="event more-events">+2 more</div></td><td>13<div class="event birthday">7a Birthday P</div></td><td>14</td><td>15<div class="event repeating">4p Repeating</div></td><td>16</td><td>17</td>
                            </tr>
                            <tr>
                                <td class="today">18<div class="event">ì˜¤ëŠ˜ì˜ ìŠ¤ì¼€ì¤„</div></td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td>
                            </tr>
                            <tr>
                                <td>25</td><td>26</td><td>27</td><td>28<div class="event">Click for Goo</div></td><td>29</td><td>30</td><td>31</td>
                            </tr>
                            <tr>
                                <td class="other-month">1</td><td class="other-month">2</td><td class="other-month">3</td><td class="other-month">4</td><td class="other-month">5</td><td class="other-month">6</td><td class="other-month">7</td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="text-align:center; margin-top:15px; font-size:0.9em;">(FullCalendar ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ êµì²´ ì˜ˆì •ì…ë‹ˆë‹¤.)</p>
                </div>
                <div id="noticeAptContent" class="tab-pane" style="display: none;">
                     <p style="padding:20px; text-align:center;">Artist A ê´€ë ¨ ì¤‘ìš” ê³µì§€ì‚¬í•­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </main>
        </div>

        <aside class="apt-sidebar">
            <div class="sidebar-widget apt-level-widget">
                <h3>APT í˜„í™©</h3>
                <div class="apt-floor-display" id="aptFloorDisplay">123ì¸µ APT</div>
                <div class="fan-count-tooltip-wrapper"> <p class="fan-count-display">íŒ¬ <span id="sidebarFanCountApprox">ì•½ 12.3ë§Œ</span> ëª…</p> <span class="fan-count-tooltip" id="sidebarFanCountExact">123,456ëª…</span> </div>
            </div>

            <div class="sidebar-widget membership-widget">
                <div class="membership-icon">ğŸ›¡ï¸</div>
                <h3>Membership</h3>
                <p>ì§€ê¸ˆ ë©¤ë²„ì‹­ì— ê°€ì…í•˜ê³  Artist Aì˜ íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”.</p>
                <button class="btn-join-membership" id="openMembershipModalBtn">
                    ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° <span class="arrow">&gt;</span>
                </button>
            </div>

             <!-- ë§ˆì´ í”„ë¡œí•„ ì˜ì—­ ì¶”ê°€ -->
             <div class="sidebar-widget my-profile-widget" style="margin-bottom: 20px; text-align: center; cursor: pointer;">
             	<div>
             		<button type="button" class="btn btn-outline-primary" id="registProfileBtn">í”„ë¡œí•„ ë§Œë“¤ê¸°</button>
             	</div>
                <div style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; overflow: hidden; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                    <img src="https://via.placeholder.com/80/8a2be2/FFFFFF?text=í”„ë¡œí•„" alt="í”„ë¡œí•„ ì‚¬ì§„" style="width: 100%; height: 100%; object-fit: cover;" onclick="location.href='my_profile.html'">
                </div>
                <p id="myProfileNickname" style="margin-top: 8px; font-weight: bold; font-size: 1.1em;">ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„</p>
            </div>

        </aside>
    </div>

    <div id="footer-placeholder"></div>

     <div class="modal-overlay" id="membershipModalOverlay" style="display: none;">
        <div class="modal-content membership-modal">
            <button class="modal-close-btn" id="closeMembershipModalBtn" title="ë‹«ê¸°">&times;</button>
            <div class="modal-header">
                <img src="https://via.placeholder.com/80x80/8A2BE2/FFFFFF?text=A" alt="Artist A ë¡œê³ " class="modal-artist-logo">
                <h2>Artist A OFFICIAL MEMBERSHIP</h2>
                <p class="membership-duration">ì´ìš© ê¸°ê°„: ê²°ì œì¼ë¡œë¶€í„° 30ì¼</p>
            </div>
            <div class="modal-body">
                <div class="membership-main-image">
                    <img src="https://via.placeholder.com/400x200/F8F0FF/8A2BE2?text=Membership+Welcome+Kit" alt="ë©¤ë²„ì‹­ ì›°ì»´ ì´ë¯¸ì§€">
                </div>
                <h3>ì£¼ìš” í˜œíƒ ì•ˆë‚´</h3>
                <ul class="modal-benefits-list">
                    <li>âœ”ï¸ ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥ (ì¼ë¶€ ë¸”ëŸ¬ ì²˜ë¦¬ëœ ì½˜í…ì¸  ì¦‰ì‹œ í•´ì œ!)</li>
                    <li>ğŸ—“ï¸ APT ë©”ì¸ ìƒë‹¨ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ êµ¬ë…ì¼ D-Day í™•ì¸</li>
                    <li>ğŸ¤ ì½˜ì„œíŠ¸/íŒ¬ë¯¸íŒ… ì„ ì˜ˆë§¤ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ ì°¸ì—¬ ê¸°íšŒ</li>
                    <li>ğŸ í•œì •íŒ ë©¤ë²„ì‹­ í‚¤íŠ¸ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë˜ëŠ” ë“±ê¸‰ì— ë”°ë¼)</li>
                </ul>

                <h3>ì´ìš© ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</h3>
                <ul class="modal-notes-list">
                    <li>ë³¸ ë©¤ë²„ì‹­ì€ ë¹„ìš©ì„ ì„ ì§€ë¶ˆí•˜ì—¬ ì´ìš©í•˜ëŠ” ìœ ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</li>
                    <li>ë©¤ë²„ì‹­ì€ ì•„í‹°ìŠ¤íŠ¸(ì†”ë¡œ, ê·¸ë£¹)ë³„ë¡œ ë³„ë„ ìš´ì˜ë˜ë©°, ë³¸ ë©¤ë²„ì‹­ì€ [Artist A] ì „ìš©ì…ë‹ˆë‹¤.</li>
                    <li>ê·¸ë£¹ ë‚´ ì†”ë¡œ í™œë™ ë©¤ë²„ ë°œìƒ ì‹œ, í•´ë‹¹ ë©¤ë²„ì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³„ë„ ìƒì„±/ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ìì„¸í•œ ë‚´ìš©ì€ êµ¬ë§¤ í˜ì´ì§€ì˜ ì•½ê´€ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <div class="membership-price">â‚©30,000 <span class="vat-notice">(VAT í¬í•¨)</span></div>
                <button class="btn-modal-purchase" id="goToPurchasePageBtn">ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë²„ë ˆì´ -->
    <div id="communityOverlay" style="display:none;">
        <div class="community-overlay-bg"></div>
        <button id="joinCommunityBtn" class="join-community-btn">ì»¤ë®¤ë‹ˆí‹° ê°€ì…</button>
    </div>

    <!-- ë‹‰ë„¤ì„ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="nicknameModal" style="display:none;">
        <div class="nickname-modal-content">
            <h2>ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”</h2>
            <input type="text" id="nicknameInput" maxlength="12" placeholder="ë‹‰ë„¤ì„">
            <h2>í”„ë¡œí•„ ì´ë¯¸ì§€</h2>
			<div id="previewImgBox">
				<img alt="" src="" id="previewImg">
			</div>            
            <input type="file" id="profileImgBtn">
            <button id="nicknameSubmitBtn" disabled>ì™„ë£Œ</button>
        </div>
    </div>

    <!-- DM ëª¨ë‹¬ì´ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="weverse-dm-modal-container"></div>

    <!-- DM ì—´ê¸° ë²„íŠ¼ (ì›í•˜ëŠ” ê³³ì— ë°°ì¹˜) -->
    <button onclick="openWeverseDM()">DM ì—´ê¸°</button>

    <script>
//         const loginBtn = document.getElementById("loginBtn");
//         const logoutBtn = document.getElementById("logoutBtn");
//         const loggedOutNav = document.getElementById("loggedOutNav");
//         const loggedInNav = document.getElementById("loggedInNav");
//         let isLoggedIn = JSON.parse(localStorage.getItem("isUserLoggedIn")) || false;
//         function updateNav() {
//             if (isLoggedIn) {
//                 loggedOutNav.style.display = "none";
//                 loggedInNav.style.display = "flex";
//             } else {
//                 loggedOutNav.style.display = "flex";
//                 loggedInNav.style.display = "none";
//             }
//         }
//         if (loginBtn) {
//             loginBtn.addEventListener("click", function (event) {
//                 event.preventDefault();
//                 isLoggedIn = true;
//                 localStorage.setItem("isUserLoggedIn", JSON.stringify(isLoggedIn));
//                 updateNav();
//             });
//         }
//         if (logoutBtn) {
//             logoutBtn.addEventListener("click", function (event) {
//                 event.preventDefault();
//                 isLoggedIn = false;
//                 localStorage.setItem("isUserLoggedIn", JSON.stringify(isLoggedIn));
//                 updateNav();
//             });
//         }
//         updateNav();

        const footerPlaceholderApt = document.getElementById('footer-placeholder');
        if (footerPlaceholderApt) { fetch('footer.html').then(response => response.ok ? response.text() : Promise.reject('Footer not found')).then(data => { footerPlaceholderApt.innerHTML = data; }).catch(error => console.error('Error loading footer:', error));}

        const aptTabs = document.querySelectorAll('.apt-tabs .tab-item');
        const aptTabPanes = document.querySelectorAll('.apt-content-area .tab-pane');
        aptTabs.forEach(tab => {
            tab.addEventListener('click', function(event) {
                event.preventDefault();
                aptTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                const targetPaneId = this.getAttribute('data-tab') + "Content";
                aptTabPanes.forEach(pane => {
                    pane.style.display = (pane.id === targetPaneId) ? 'block' : 'none';
                });
            });
        });
        if(aptTabs.length > 0 && aptTabPanes.length > 0) {
            aptTabs[0].classList.add('active');
            aptTabPanes[0].style.display = 'block';
            for(let i = 1; i < aptTabPanes.length; i++){ aptTabPanes[i].style.display = 'none';}
        }

        function setupPostForm(textareaId, buttonId) {
            const textarea = document.getElementById(textareaId);
            const button = document.getElementById(buttonId);
            if (textarea && button) {
                textarea.addEventListener('input', function() {
                    button.disabled = this.value.trim().length === 0;
                });
                button.addEventListener('click', function() {
                    const postContent = textarea.value.trim();
                    if (postContent) {
                        alert(`(\${buttonId.includes('Artist') ? 'ì•„í‹°ìŠ¤íŠ¸' : 'íŒ¬'}) ê²Œì‹œë¬¼ ë“±ë¡! (ë‚´ìš©: \${postContent})\nì‹¤ì œë¡œëŠ” ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.`);
                        textarea.value = '';
                        this.disabled = true;
                    }
                });
            }
        }
        setupPostForm('postTextareaArtist', 'submitPostBtnArtist');
        setupPostForm('postTextareaFan', 'submitPostBtnFan');

        const fanCountForAptEl = document.getElementById('fanCountForApt');
        const sidebarFanCountApproxEl = document.getElementById('sidebarFanCountApprox');
        const sidebarFanCountExactEl = document.getElementById('sidebarFanCountExact');
        const aptFloorDisplayEl = document.getElementById('aptFloorDisplay');

        function formatFanCountApprox(count) {
            if (count >= 10000) {
                return (count / 10000).toFixed(1) + 'ë§Œ';
            }
            return count.toLocaleString();
        }

        function updateAptLevelDisplay(exactFanCount) {
            const approxFanCount = formatFanCountApprox(exactFanCount);

            if (fanCountForAptEl) fanCountForAptEl.textContent = exactFanCount.toLocaleString();
            if (sidebarFanCountApproxEl) sidebarFanCountApproxEl.textContent = approxFanCount;
            if (sidebarFanCountExactEl) sidebarFanCountExactEl.textContent = exactFanCount.toLocaleString() + 'ëª…';

            let floor = exactFanCount >= 100 ? Math.floor(exactFanCount / 100) : 1;
            if (aptFloorDisplayEl) aptFloorDisplayEl.textContent = `\${floor}ì¸µ APT`;
        }

        let currentFanCount = 123456;
        updateAptLevelDisplay(currentFanCount);

        // ì»¤ë®¤ë‹ˆí‹° ê°€ì… ìƒíƒœ ê´€ë¦¬
        let isCommunityJoined = JSON.parse(localStorage.getItem("isCommunityJoined")) || false;
        let communityNickname = localStorage.getItem("communityNickname") || "";

        // íŒ”ë¡œìš° ë²„íŠ¼ ì œì–´
        const followToggleBtn = document.getElementById('followToggleBtn');
        function updateFollowBtn() {
            if (!isCommunityJoined) {
                followToggleBtn.innerHTML = '<span class="follow-icon">+</span> íŒ”ë¡œìš°';
                followToggleBtn.classList.remove('following');
            } else {
                followToggleBtn.innerHTML = '<span class="follow-icon">âœ”</span> íŒ”ë¡œì‰';
                followToggleBtn.classList.add('following');
            }
        }
        updateFollowBtn();

        // ì˜¤ë²„ë ˆì´/ëª¨ë‹¬ DOM
        const communityOverlay = document.getElementById('communityOverlay');
        const joinCommunityBtn = document.getElementById('joinCommunityBtn');
        const nicknameModal = document.getElementById('nicknameModal');
        const nicknameInput = document.getElementById('nicknameInput');
        const nicknameSubmitBtn = document.getElementById('nicknameSubmitBtn');

        // ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€
        function showCommunityOverlay() {
            communityOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        function hideCommunityOverlay() {
            communityOverlay.style.display = 'none';
            document.body.style.overflow = '';
        }

        // ë‹‰ë„¤ì„ ëª¨ë‹¬ í‘œì‹œ/ìˆ¨ê¹€
        function showNicknameModal() {
            nicknameModal.style.display = 'flex';
            nicknameInput.value = '';
            nicknameSubmitBtn.disabled = true;
            setTimeout(() => nicknameInput.focus(), 100);
        }
        function hideNicknameModal() {
            nicknameModal.style.display = 'none';
        }

        let overlayChecked = false;
        // ê°€ì… ìƒíƒœì— ë”°ë¼ ì˜¤ë²„ë ˆì´/íŒ”ë¡œìš° ë²„íŠ¼ ì œì–´
        function checkCommunityJoinState() {
            if (!overlayChecked) {
            	console.log("ss")
                showCommunityOverlay();
                updateFollowBtn();
                followToggleBtn.disabled = true;
            } else {
                hideCommunityOverlay();
                hideNicknameModal();
                updateFollowBtn();
                followToggleBtn.disabled = false;
            }
        }
        checkCommunityJoinState();

        // ì˜¤ë²„ë ˆì´ì—ì„œ "ì»¤ë®¤ë‹ˆí‹° ê°€ì…" í´ë¦­ ì‹œ
        joinCommunityBtn.onclick = function() {
            showNicknameModal();
        };

        // ë‹‰ë„¤ì„ ì…ë ¥ í™œì„±í™”
        nicknameInput.addEventListener('input', function() {
            nicknameSubmitBtn.disabled = !this.value.trim();
        });

        // ë‹‰ë„¤ì„ "ì™„ë£Œ" í´ë¦­ ì‹œ
        nicknameSubmitBtn.onclick = function() {
            const nickname = nicknameInput.value.trim();
            if (nickname) {
                isCommunityJoined = true;
                communityNickname = nickname;
                localStorage.setItem("isCommunityJoined", JSON.stringify(true));
                localStorage.setItem("communityNickname", nickname);
                checkCommunityJoinState();
            }
        };

        // íŒ”ë¡œìš° ë²„íŠ¼ í´ë¦­ ì‹œ (ê°€ì… ì „ì—ëŠ” ëª¨ë‹¬ ë„ì›€)
        followToggleBtn.onclick = function() {
            if (!isCommunityJoined) {
                showNicknameModal();
            } else {
                // íŒ”ë¡œì‰ ìƒíƒœ í† ê¸€ ë“± ì¶”ê°€ ë¡œì§ í•„ìš”ì‹œ ì—¬ê¸°ì—
            }
        };

        const artistLiveControls = document.getElementById('artistLiveControls');
        const currentUserIsArtist = true;

        if (artistLiveControls) {
            if (currentUserIsArtist) {
                artistLiveControls.style.display = 'block';
            } else {
                artistLiveControls.style.display = 'none';
            }
        }

        const btnStartLive = document.querySelector('.btn-start-live');
        if (btnStartLive) {
            btnStartLive.addEventListener('click', function() {
                alert('ì‹¤ì‹œê°„ ë¼ì´ë¸Œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤! (ì‹¤ì œ ìŠ¤íŠ¸ë¦¬ë° ì„œë²„ ì—°ë™ í•„ìš”)');
            });
        }

        const currentMonthYearEl = document.getElementById('currentMonthYear');
        const calendarBodyEl = document.getElementById('calendarBody');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const todayBtn = document.getElementById('todayBtn');

        let currentCalendarDate = new Date();

        function renderCalendar(date) {
            if (!currentMonthYearEl || !calendarBodyEl) return;

            const year = date.getFullYear();
            const month = date.getMonth();

            currentMonthYearEl.textContent = `\${year}ë…„ \${month + 1}ì›”`;
            console.log(`Rendering calendar for \${year}-\${month + 1}`);
        }

        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                renderCalendar(currentCalendarDate);
            });
        }
        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                renderCalendar(currentCalendarDate);
            });
        }
        if (todayBtn) {
            todayBtn.addEventListener('click', () => {
                currentCalendarDate = new Date();
                renderCalendar(currentCalendarDate);
            });
        }

        renderCalendar(currentCalendarDate);

        const openMembershipModalButton = document.getElementById('openMembershipModalBtn');
        const membershipModalOverlay = document.getElementById('membershipModalOverlay');
        const closeMembershipModalButton = document.getElementById('closeMembershipModalBtn');
        const goToPurchasePageButton = document.getElementById('goToPurchasePageBtn');

        function openMembershipModal() {
            if (membershipModalOverlay) {
                membershipModalOverlay.style.display = 'flex';
                setTimeout(() => {
                    membershipModalOverlay.classList.add('active');
                }, 10);
            }
        }

        function closeMembershipModal() {
            if (membershipModalOverlay) {
                membershipModalOverlay.classList.remove('active');
            }
        }

        if (openMembershipModalButton) {
            openMembershipModalButton.addEventListener('click', function(event) {
                event.preventDefault();
                openMembershipModal();
            });
        }

        if (closeMembershipModalButton) {
            closeMembershipModalButton.addEventListener('click', closeMembershipModal);
        }

        if (membershipModalOverlay) {
            membershipModalOverlay.addEventListener('click', function(event) {
                if (event.target === membershipModalOverlay) {
                    closeMembershipModal();
                }
            });
        }

        if (goToPurchasePageButton) {
            goToPurchasePageButton.addEventListener('click', function() {
                alert('ë©¤ë²„ì‹­ êµ¬ë§¤ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ì‹¤ì œ í˜ì´ì§€ ì´ë™ ë¡œì§ í•„ìš”)');
                closeMembershipModal();
            });
        }

        // ê³„ì • ìƒíƒœ ê´€ë¦¬
        let currentAccountType = localStorage.getItem('currentAccountType') || 'fan';
        const switchToArtistBtn = document.getElementById('switchToArtist');
        const switchToFanBtn = document.getElementById('switchToFan');
        if (switchToArtistBtn) switchToArtistBtn.onclick = () => { currentAccountType = 'artist'; localStorage.setItem('currentAccountType', 'artist'); updateAptUI(); };
        if (switchToFanBtn) switchToFanBtn.onclick = () => { currentAccountType = 'fan'; localStorage.setItem('currentAccountType', 'fan'); updateAptUI(); };

        // ê²Œì‹œê¸€/ëŒ“ê¸€ ë°ì´í„° (ì„ì‹œ)
        let aptPosts = [
            { id: 1, authorType: 'artist', authorName: 'Artist A', title: 'ì²« ì¸ì‚¬', content: 'íŒ¬ ì—¬ëŸ¬ë¶„ ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ë„¤ìš”! ë‹¤ë“¤ ì¦ê±°ìš´ í•˜ë£¨ ë³´ë‚´ê³  ê³„ì‹ ê°€ìš”? ì €í¬ëŠ” ì—´ì‹¬íˆ ë‹¤ìŒ ë¬´ëŒ€ë¥¼ ì¤€ë¹„í•˜ê³  ìˆë‹µë‹ˆë‹¤! ê¸°ëŒ€ ë§ì´ í•´ì£¼ì„¸ìš”! âœ¨', comments: [
                { id: 1, authorType: 'fan', authorName: 'ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„', content: 'ì™€! ì•„í‹°ìŠ¤íŠ¸ë‹˜ ê¸€ì´ë‹¤!!', isMine: true }
            ] },
            { id: 2, authorType: 'fan', authorName: 'ì—´í˜ˆíŒ¬123', title: 'ì‘ì›í•´ìš”', content: 'Artist A ì´ë²ˆ ì•¨ë²” ë„ˆë¬´ ì¢‹ì•„ìš”! ë§¤ì¼ ë“£ê³  ìˆìŠµë‹ˆë‹¤. í•­ìƒ ì‘ì›í•´ìš”! â¤ï¸', comments: [
                { id: 2, authorType: 'fan', authorName: 'ArtistXíŒ¬', content: 'ì •ë§ ë©‹ì§„ ê·¸ë¦¼ì´ë„¤ìš”!', isMine: false },
                { id: 3, authorType: 'fan', authorName: 'ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„', content: '@ArtistXíŒ¬ ê°ì‚¬í•©ë‹ˆë‹¤! :)', isMine: true }
            ] }
        ];
        let aptPostIdSeq = 3;
        let aptCommentIdSeq = 4;

        function updateAptUI() {
            // íƒ­ ìƒíƒœ í™•ì¸
            const activeTab = document.querySelector('.apt-tabs .tab-item.active').getAttribute('data-tab');
            // ì•„í‹°ìŠ¤íŠ¸ íƒ­
            if (activeTab === 'artistFeed') {
                // ì…ë ¥ì°½: ì•„í‹°ìŠ¤íŠ¸ ê³„ì •ë§Œ ë…¸ì¶œ
                document.getElementById('artistFeedPostFormWrap').innerHTML = (currentAccountType === 'artist') ? `
                    <div class="feed-post-form">
                        <input type="text" id="artistPostTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%;margin-bottom:7px;padding:7px 10px;border:1px solid #ccc;border-radius:6px;font-size:0.95em;">
                        <textarea id="artistPostContent" placeholder="Artist Aê°€ íŒ¬ë“¤ì—ê²Œ ë‚¨ê¸°ëŠ” ë©”ì‹œì§€... (ê´€ë¦¬ììš©)"></textarea>
                        <div class="form-actions">
                            <label style="display:inline-flex;align-items:center;gap:5px;margin-right:10px;">
                                <input type="checkbox" id="membershipOnlyCheck" style="width:16px;height:16px;">
                                ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸ 
                            </label>
                            <button class="btn-submit-post" id="submitArtistPostBtn" disabled>ë“±ë¡ (ì•„í‹°ìŠ¤íŠ¸)</button>
                        </div>
                    </div>` : '';
                // ê²€ìƒ‰ì°½: í•­ìƒ ë…¸ì¶œ
                document.getElementById('artistFeedSearchWrap').style.display = 'flex';
                // ê²Œì‹œê¸€ ëª©ë¡: ì•„í‹°ìŠ¤íŠ¸ ê¸€ë§Œ, ê²€ìƒ‰ì–´ ë°˜ì˜
                renderAptPostList('artist');
                // ì…ë ¥ì°½ ì´ë²¤íŠ¸
                if (currentAccountType === 'artist') {
                    const titleInput = document.getElementById('artistPostTitle');
                    const contentInput = document.getElementById('artistPostContent');
                    const submitBtn = document.getElementById('submitArtistPostBtn');
                    function checkValid() {
                        submitBtn.disabled = !(titleInput.value.trim() && contentInput.value.trim());
                    }
                    titleInput.addEventListener('input', checkValid);
                    contentInput.addEventListener('input', checkValid);
                    submitBtn.addEventListener('click', function() {
                        if (titleInput.value.trim() && contentInput.value.trim()) {
                            aptPosts.unshift({ 
                                id: aptPostIdSeq++, 
                                authorType: 'artist', 
                                authorName: 'Artist A', 
                                title: titleInput.value.trim(), 
                                content: contentInput.value.trim(), 
                                comments: [],
                                isMembershipOnly: document.getElementById('membershipOnlyCheck').checked
                            });
                            titleInput.value = '';
                            contentInput.value = '';
                            document.getElementById('membershipOnlyCheck').checked = false;
                            submitBtn.disabled = true;
                            renderAptPostList('artist');
                        }
                    });
                }
            } else if (activeTab === 'fanFeed') {
                // ì…ë ¥ì°½: íŒ¬ ê³„ì •ë§Œ ë…¸ì¶œ
                document.getElementById('fanFeedPostFormWrap').innerHTML = (currentAccountType === 'fan') ? `
                    <div class="feed-post-form">
                        <input type="text" id="fanPostTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%;margin-bottom:7px;padding:7px 10px;border:1px solid #ccc;border-radius:6px;font-size:0.95em;">
                        <textarea id="fanPostContent" placeholder="Artist Aì—ê²Œ ì‘ì›ì˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!"></textarea>
                        <div class="form-actions">
                            <button class="btn-submit-post" id="submitFanPostBtn" disabled>ë“±ë¡ (íŒ¬)</button>
                        </div>
                    </div>` : '';
                document.getElementById('artistFeedSearchWrap').style.display = 'none';
                renderAptPostList('fan');
                if (currentAccountType === 'fan') {
                    const titleInput = document.getElementById('fanPostTitle');
                    const contentInput = document.getElementById('fanPostContent');
                    const submitBtn = document.getElementById('submitFanPostBtn');
                    function checkValid() {
                        submitBtn.disabled = !(titleInput.value.trim() && contentInput.value.trim());
                    }
                    titleInput.addEventListener('input', checkValid);
                    contentInput.addEventListener('input', checkValid);
                    submitBtn.addEventListener('click', function() {
                        if (titleInput.value.trim() && contentInput.value.trim()) {
                            aptPosts.unshift({ id: aptPostIdSeq++, authorType: 'fan', authorName: 'ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„', title: titleInput.value.trim(), content: contentInput.value.trim(), comments: [] });
                            titleInput.value = '';
                            contentInput.value = '';
                            submitBtn.disabled = true;
                            renderAptPostList('fan');
                        }
                    });
                }
            } else {
                document.getElementById('artistFeedSearchWrap').style.display = 'none';
            }
        }

        function renderAptPostList(type) {
            let searchKeyword = '';
            if (type === 'artist') {
                searchKeyword = document.getElementById('artistFeedSearchInput').value.trim().toLowerCase();
            }
            const listWrap = (type === 'artist') ? document.getElementById('artistFeedList') : document.getElementById('fanFeedList');
            let filtered = aptPosts.filter(p => p.authorType === type);
            if (type === 'artist' && searchKeyword) {
                filtered = filtered.filter(p => p.title.toLowerCase().includes(searchKeyword) || p.content.toLowerCase().includes(searchKeyword));
            }
            if (filtered.length === 0) {
                listWrap.innerHTML = `<div style="padding:30px 0;text-align:center;color:#888;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            listWrap.innerHTML = filtered.map(post => {
                if (post.editing) {
                    return `
                    <div class="feed-item" data-post-id="\${post.id}">
                        <div class="feed-item-header">
                            <div class="author-avatar" style="background-color:\${post.authorType==='artist'?'#8a2be2':'#e9ecef'};color:\${post.authorType==='artist'?'#fff':'#333'};">\${post.authorType==='artist'?'A':'íŒ¬'}</div>
                            <div class="author-info">
                                <span class="author-name" style="color:\${post.authorType==='artist'?'#8a2be2':'#333'};">${post.authorName}</span>
                                <span class="post-time">ë°©ê¸ˆ ì „</span>
                            </div>
                            <div class="post-options">
                                <button class="post-options-btn" style="background:none;border:none;font-size:1.2em;cursor:pointer;">â€¢â€¢â€¢</button>
                                <div class="post-options-menu" style="display:none;position:absolute;right:0;top:30px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);z-index:10;min-width:90px;">
                                    <div class="post-option-item" data-action="cancel-edit">ìˆ˜ì • ì·¨ì†Œ</div>
                                </div>
                            </div>
                        </div>
                        <div class="feed-item-content">
                            <input type="text" class="edit-title-input" value="\${post.title.replace(/"/g, '&quot;')}" style="width:100%;margin-bottom:7px;padding:7px 10px;border:1px solid #ccc;border-radius:6px;font-size:0.95em;">
                            <textarea class="edit-content-input" style="width:100%;min-height:70px;padding:10px;border:1px solid #ccc;border-radius:6px;font-size:0.95em;">\${post.content.replace(/</g, '&lt;')}</textarea>
                            <div style="margin-top:8px;text-align:right;">
                                <button class="btn-save-edit" style="padding:7px 18px;background:#8a2be2;color:#fff;border:none;border-radius:20px;font-weight:bold;">ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                    `;
                } else {
                    return `
                    <div class="feed-item\${post.isMembershipOnly ? ' membership-only' : ''}" data-post-id="${post.id}">
                        <div class="feed-item-header">
                            <div class="author-avatar" style="background-color:\${post.authorType==='artist'?'#8a2be2':'#e9ecef'};color:\${post.authorType==='artist'?'#fff':'#333'};">\${post.authorType==='artist'?'A':'íŒ¬'}</div>
                            <div class="author-info">
                                <span class="author-name" style="color:\${post.authorType==='artist'?'#8a2be2':'#333'};">\${post.authorName}</span>
                                <span class="post-time">ë°©ê¸ˆ ì „</span>
                                \${post.isMembershipOnly ? '<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>' : ''}
                            </div>
                            <div class="post-options">
                                <button class="post-options-btn" style="background:none;border:none;font-size:1.2em;cursor:pointer;">â€¢â€¢â€¢</button>
                                <div class="post-options-menu" style="display:none;position:absolute;right:0;top:30px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);z-index:10;min-width:90px;">
                                    \${isMyPost(post) ? `<div class="post-option-item" data-action="edit">ìˆ˜ì •</div><div class="post-option-item" data-action="delete">ì‚­ì œ</div>` : `<div class="post-option-item" data-action="report">ì‹ ê³ </div>`}
                                </div>
                            </div>
                        </div>
                        <div class="feed-item-content\${post.isMembershipOnly ? ' membership-blur' : ''}" style="\${post.isMembershipOnly ? 'position:relative;' : ''}">
                            \${post.isMembershipOnly ? `
                                <div class="membership-overlay" style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1;">
                                    <div style="text-align:center;padding:20px;">
                                        <div style="font-size:1.2em;font-weight:bold;margin-bottom:10px;">ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸ ì…ë‹ˆë‹¤</div>
                                        <p style="color:#666;margin-bottom:15px;">ì´ ê²Œì‹œë¬¼ì€ ë©¤ë²„ì‹­ íšŒì›ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                        <button class="btn-join-membership" onclick="openMembershipModal()" style="background:#8a2be2;color:#fff;border:none;padding:8px 20px;border-radius:20px;cursor:pointer;">
                                            ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸°
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                            <div class="post-title" style="font-weight:bold;font-size:1.1em;margin-bottom:5px;">\${post.title}</div>
                            <p class="post-text">\${post.content.replace(/\n/g, '<br>')}</p>
                        </div>
                        <div class="feed-item-actions">
                            <button class="action-btn comment-toggle-btn">ğŸ’¬ ëŒ“ê¸€ <span class="count">\${post.comments.length}</span></button>
                        </div>
                        <div class="comments-wrapper" style="display:none;"></div>
                    </div>
                    `;
                }
            }).join('');
            // ì˜µì…˜ ë©”ë‰´, ëŒ“ê¸€, ... ì´ë²¤íŠ¸ ë°”ì¸ë”©
            listWrap.querySelectorAll('.post-options-btn').forEach(btn => {
                btn.onclick = function(e) {
                    e.stopPropagation();
                    document.querySelectorAll('.post-options-menu').forEach(m => m.style.display = 'none');
                    const menu = this.nextElementSibling;
                    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
                };
            });
            document.addEventListener('click', function() {
                document.querySelectorAll('.post-options-menu').forEach(m => m.style.display = 'none');
            });
            listWrap.querySelectorAll('.post-options-menu .post-option-item').forEach(item => {
                item.onclick = function(e) {
                    e.stopPropagation();
                    const feedItem = this.closest('.feed-item');
                    const postId = parseInt(feedItem.getAttribute('data-post-id'));
                    const action = this.getAttribute('data-action');
                    if (action === 'edit') {
                        aptPosts = aptPosts.map(p => p.id === postId ? { ...p, editing: true } : { ...p, editing: false });
                        renderAptPostList(type);
                    } else if (action === 'cancel-edit') {
                        aptPosts = aptPosts.map(p => ({ ...p, editing: false }));
                        renderAptPostList(type);
                    } else if (action === 'delete') {
                        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            aptPosts = aptPosts.filter(p => p.id !== postId);
                            renderAptPostList(type);
                        }
                    } else if (action === 'report') {
                        const reason = prompt('ì‹ ê³  ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                        if (reason && reason.trim()) {
                            alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\nì‚¬ìœ : ' + reason);
                        }
                    }
                };
            });
            // ìˆ˜ì • ì €ì¥ ë²„íŠ¼
            listWrap.querySelectorAll('.btn-save-edit').forEach(btn => {
                btn.onclick = function() {
                    const feedItem = this.closest('.feed-item');
                    const postId = parseInt(feedItem.getAttribute('data-post-id'));
                    const titleInput = feedItem.querySelector('.edit-title-input');
                    const contentInput = feedItem.querySelector('.edit-content-input');
                    if (!titleInput.value.trim() || !contentInput.value.trim()) {
                        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                        return;
                    }
                    aptPosts = aptPosts.map(p => p.id === postId ? { ...p, title: titleInput.value.trim(), content: contentInput.value.trim(), editing: false } : { ...p, editing: false });
                    renderAptPostList(type);
                };
            });
            // ëŒ“ê¸€ í† ê¸€/ë“±ë¡
            listWrap.querySelectorAll('.comment-toggle-btn').forEach(btn => {
                btn.onclick = function() {
                    const feedItem = this.closest('.feed-item');
                    const postId = parseInt(feedItem.getAttribute('data-post-id'));
                    const post = aptPosts.find(p => p.id === postId);
                    const wrapper = feedItem.querySelector('.comments-wrapper');
                    if (wrapper.style.display === 'block') {
                        wrapper.style.display = 'none';
                        return;
                    }
                    wrapper.style.display = 'block';
                    renderAptCommentList(wrapper, post, type);
                };
            });
        }

        function renderAptCommentList(wrapper, post, type) {
            wrapper.innerHTML = `
                <div class="comment-form-container">
                    <textarea class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                    <button class="btn-submit-comment" disabled>ë“±ë¡</button>
                </div>
                <div class="comment-list">
                    \${post.comments.map(c => `
                        <div class="comment-item\${c.isMine ? ' my-comment' : ''}">
                            <div class="comment-author-avatar">\${c.isMine ? 'ë‚˜' : c.authorName[0]}</div>
                            <div class="comment-content">
                                <span class="comment-author-name">\${c.authorName}</span>
                                <p class="comment-text">\${c.content.replace(/\n/g, '<br>')}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            const textarea = wrapper.querySelector('.comment-textarea');
            const btn = wrapper.querySelector('.btn-submit-comment');
            textarea.addEventListener('input', function() {
                btn.disabled = !this.value.trim();
            });
            btn.addEventListener('click', function() {
                if (textarea.value.trim()) {
                    post.comments.push({ id: aptCommentIdSeq++, authorType: currentAccountType, authorName: (currentAccountType==='artist'?'Artist A':'ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„'), content: textarea.value.trim(), isMine: true });
                    textarea.value = '';
                    btn.disabled = true;
                    renderAptCommentList(wrapper, post, type);
                    renderAptPostList(type);
                }
            });
        }

        function isMyPost(post) {
            return (currentAccountType === post.authorType && (post.authorType === 'artist' || post.authorName === 'ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„'));
        }

        document.getElementById('artistFeedSearchInput').addEventListener('input', function() {
            renderAptPostList('artist');
        });

        document.querySelectorAll('.apt-tabs .tab-item').forEach(tab => {
            tab.addEventListener('click', function(event) {
                event.preventDefault();
                document.querySelectorAll('.apt-tabs .tab-item').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                const targetPaneId = this.getAttribute('data-tab') + "Content";
                document.querySelectorAll('.apt-content-area .tab-pane').forEach(pane => {
                    pane.style.display = (pane.id === targetPaneId) ? 'block' : 'none';
                });
                updateAptUI();
            });
        });

        // ìµœì´ˆ ë Œë”ë§
        updateAptUI();

        function openWeverseDM() {
            // ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë©´ ë‹¤ì‹œ appendí•˜ì§€ ì•Šê³  showë§Œ
            if (document.getElementById('weverse-dm-root')) {
                document.getElementById('weverse-dm-root').style.display = '';
                return;
            }
            fetch('direct_meassage.html')
                .then(res => res.text())
                .then(html => {
                    // ì„ì‹œ divë¡œ íŒŒì‹±
                    const temp = document.createElement('div');
                    temp.innerHTML = html;
                    // DM ëª¨ë‹¬ ë³¸ì²´ë§Œ ì¶”ì¶œ
                    const dmRoot = temp.querySelector('#weverse-dm-root');
                    if (dmRoot) {
                        // ëª¨ë‹¬ ìŠ¤íƒ€ì¼(ì¤‘ì•™, ì˜¤ë²„ë ˆì´) ì¶”ê°€
                        dmRoot.style.position = 'fixed';
                        dmRoot.style.top = '50%';
                        dmRoot.style.left = '50%';
                        dmRoot.style.transform = 'translate(-50%, -50%)';
                        dmRoot.style.zIndex = '9999';
                        dmRoot.style.boxShadow = '0 8px 32px rgba(0,0,0,0.18)';
                        document.getElementById('weverse-dm-modal-container').appendChild(dmRoot);
                    }
                    // script ì‹¤í–‰ (WeverseDM ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë“±ë¡)
                    const scripts = temp.querySelectorAll('script');
                    scripts.forEach(scr => {
                        const s = document.createElement('script');
                        if (scr.src) s.src = scr.src;
                        else s.textContent = scr.textContent;
                        document.body.appendChild(s);
                    });
                });
        }

        // DM ë‹«ê¸° í•¨ìˆ˜ (WeverseDM.close() ë‚´ë¶€ì—ì„œ ìë™ ì²˜ë¦¬ë¨)
        function closeWeverseDM() {
            if (document.getElementById('weverse-dm-root')) {
                document.getElementById('weverse-dm-root').style.display = 'none';
            }
        }
        
       	const registProfileBtn = document.getElementById("registProfileBtn")
        
       	registProfileBtn.addEventListener("click",function(){
       		console.log(nicknameModal);
       		showNicknameModal();
        }) 
    </script>
</body>
</html>