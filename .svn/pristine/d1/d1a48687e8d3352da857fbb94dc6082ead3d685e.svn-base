<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN - 직원 시스템</title>
    <%@ include file ="../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style type="text/css">
	    .dashboard-grid .card-icon {
            font-size: 2.5em; /* 아이콘 크기 조정 */
            margin-bottom: 10px;
        }
        .dashboard-grid .summary-card .count {
            font-size: 2em; /* 숫자 크기 조정 */
        }
    </style>
</head>
<body>
	<sec:authentication property="principal.employeeVO" var="empVO"/>
    <div class="emp-container">
        <%@ include file="./modules/header.jsp" %>

        <div class="emp-body-wrapper">
            <%@ include file="./modules/aside.jsp" %>

            <main class="emp-content">

            	<div class="portal-welcome-message">
                    <h2>DDTOWN 직원 시스템</h2>
                    <p>환영합니다, ${empVO.peoName} <small>(${empVO.empDepartNm} ${empVO.empPositionNm})</small> 님! 왼쪽 메뉴를 통해 각 항목을 관리할 수 있습니다.</p>
                    <p class="current-time-text">현재 시간: <span id="currentTime"></span></p>
                </div>

                <div class="dashboard-grid">
                	<div class="dashboard-card summary-card">
                		<a href="${pageContext.request.contextPath}/emp/edms/approvalBox" class="emp-menu-item">
	                		<div style="" class="card-icon"><i class="fas fa-file-signature"></i></div>
	                        <div class="card-content">
	                            <h3>전자 결재</h3>
	                            <p class="emp-menu-description">기안서 작성, 결재 요청 확인 및 문서 관리를 진행합니다.</p>
	                        </div>
                        </a>
                	</div>
                	<div class="dashboard-card summary-card">
                		<a href="${pageContext.request.contextPath}/emp/audition/schedule" class="emp-menu-item">
	                		<div class="card-icon"><i class="fas fa-microphone-alt"></i></div>
	                        <div class="card-content">
	                            <h3>오디션 관리</h3>
	                            <p class="emp-menu-description">오디션 공고 등록, 지원자 정보 관리 및 심사를 진행합니다.</p>
	                        </div>
                        </a>
                	</div>
                	<div class="dashboard-card summary-card">
                		<a href="${pageContext.request.contextPath}/emp/group/group-management" class="emp-menu-item">
	                		<div class="card-icon"><i class="fas fa-users"></i></div>
	                        <div class="card-content">
	                            <h3>아티스트 그룹 관리</h3>
	                            <p class="emp-menu-description">커뮤니티 게시글 모니터링, 사용자 관리 및 운영 업무를 수행합니다.</p>
	                        </div>
                        </a>
                	</div>
                	<div class="dashboard-card summary-card">
                		<a href="${pageContext.request.contextPath}/emp/concert/schedule/list" class="emp-menu-item">
	                		<div class="card-icon"><i class="fas fa-ticket-alt"></i></div>
	                        <div class="card-content">
	                            <h3>콘서트 관리</h3>
	                            <p class="emp-menu-description">콘서트 정보 등록, 예매 현황 확인 및 관련 통계를 관리합니다.</p>
	                        </div>
                        </a>
                	</div>
                </div>

                <div class="row g-2 dashboard-statics-grid">
	                <section class="card shadow-sm mb-4">
	                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
	                        <h3 class="h5 mb-0"><i class="fas fa-comments me-2"></i> 커뮤니티 활동 통계</h3>
	                        <div class="stats-filter-group">
	                            <select id="communityActivityPeriod" class="form-select form-select-sm">
	                                <option value="daily">일간</option>
	                                <option value="weekly">주간</option>
	                                <option value="monthly">월간</option>
	                            </select>
	                        </div>
	                    </div>
	                    <div class="card-body chart-body">
	                        <div class="chart-container"><canvas id="postCountChart"></canvas></div>
	                        <div class="chart-container"><canvas id="likeCountChart"></canvas></div>
	                    </div>
	                </section>
	                <section class="card shadow-sm mb-4" >
	                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
	                        <h3 class="h5 mb-0"><i class="fas fa-wallet me-2"></i> 오디션 현황</h3>
	                        <div class="stats-filter-group">
	                            <select id="revenueSectorFilter" class="form-select form-select-sm">
	                                <option value="all">전체 수익</option>
	                                <option value="goodsshop">굿즈샵</option>
	                                <option value="membership">멤버십</option>
	                                <option value="concert">콘서트</option>
	                            </select>
	                        </div>
	                    </div>
	                    <div class="card-body chart-body">
	                        <div class="chart-container"><canvas id="revenueBySectorChart"></canvas></div>
	                    </div>
	                </section>
                </div>
                <div class="row g-2 dashboard-statics-grid">
	                <section class="card shadow-sm mb-4">
	                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
	                        <h3 class="h5 mb-0"><i class="fas fa-comments me-2"></i> 콘서트 통계</h3>
	                        <div class="stats-filter-group">
	                            <select id="communityActivityPeriod" class="form-select form-select-sm">
	                                <option value="daily">일간</option>
	                                <option value="weekly">주간</option>
	                                <option value="monthly">월간</option>
	                            </select>
	                        </div>
	                    </div>
	                    <div class="card-body chart-body">
	                        <div class="chart-container"><canvas id="postCountChart"></canvas></div>
	                        <div class="chart-container"><canvas id="likeCountChart"></canvas></div>
	                    </div>
	                </section>
                </div>
            </main>
        </div>
    </div>
<%@ include file="../modules/footerPart.jsp" %>

<%@ include file="../modules/sidebar.jsp" %>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 현재 시간 표시 함수
    function updateCurrentTime() {
        const now = new Date();
        const options = {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false // 24시간 형식
        };
        document.getElementById('currentTime').textContent = now.toLocaleDateString('ko-KR', options);
    }

    // 페이지 로드 시 바로 호출
    updateCurrentTime();
    // 1초마다 시간 업데이트
    setInterval(updateCurrentTime, 1000);

 	// 차트관련 객체생성
    const chartMap = {};

 	// 커뮤니티 활동 통계
    createChart('postCountChart', 'line',
    	    {
    	        labels: ['월', '화', '수', '목', '금', '토', '일'],
    	        datasets: [
    	        	{
	    	            label: '게시물 수',
	    	            data: [30, 40, 35, 50, 45, 60, 55],
	    	            borderColor: '#34495e',
	    	            tension: 0.2,
	    	            fill: false
    	        	}
   	        	]
    	    },
    	    {
    	        responsive: true,
    	        maintainAspectRatio: false,
    	        plugins: {
    	            legend: {
    	                display: true
    	            }
    	        }
    	    }
    	);
	    createChart('likeCountChart', 'bar',
    	    {
    	        labels: ['월', '화', '수', '목', '금', '토', '일'],
    	        datasets: [
    	        	{
	    	            label: '좋아요 수',
	    	            data: [100, 120, 110, 130, 125, 140, 135],
	    	            backgroundColor: '#e67e22'
    	        	}
   	        	]
    	    },
    	    {
    	        responsive: true,
    	        maintainAspectRatio: false,
    	        plugins: {
    	            legend: {
    	                display: true
    	            }
    	        },
    	        scales: {
    	            y: {
    	                beginAtZero: true
    	            }
    	        }
    	    }
    	);


	 // 다른 차트들 초기화
    function createChart(id, type, data, options, plugin = false) {
        const ctx = document.getElementById(id);
        if(chartMap[id] != null){
        	chartMap[id].destroy();
        }

        if (ctx) {
        	let myChart = null;
        	if(plugin){
        		myChart= new Chart(ctx.getContext('2d'), {
	                type: type,
	                data: data,
	                plugins : [ChartDataLabels],
	                options: options
	            });
        	}else{
	            myChart = new Chart(ctx.getContext('2d'), {
	                type: type,
	                data: data,
	                options: options
	            });
        	}
            chartMap[id] = myChart;
        }
    }
})
</script>
</body>
</html>