<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.ddit.ddtown.mapper.admin.group.IAdminArtistGroupMapper">
 
 	<sql id="searchArtist">
 		<if test="searchWord != null and searchWord != ''">
 			and (art_group_nm like '%' || #{searchWord} || '%')
 		</if>
 	</sql>
 	
 	<resultMap type="kr.or.ddit.vo.artist.ArtistGroupVO" id="artistGroupMap">
		<id property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="artGroupTypeCode" column="ART_GROUP_TYPE_CODE"/>
		<result property="empUsername" column="EMP_USERNAME"/>
		<result property="artGroupNm" column="ART_GROUP_NM"/>
		<result property="artGroupContent" column="ART_GROUP_CONTENT"/>
		<result property="artGroupProfileImg" column="ART_GROUP_PROFILE_IMG"/>
		<result property="artGroupDebutdate" column="ART_GROUP_DEBUTDATE"/>
		<result property="artGroupDelYn" column="ART_GROUP_DEL_YN"/>
	 	<result property="artGroupRegDate" column="ART_GROUP_REG_DATE"/>
		<result property="artGroupModDate" column="ART_GROUP_MOD_DATE"/>
		<result property="empName" column="empName"/>
		
		<collection property="artistList" resultMap="artistMap" />
 	</resultMap>
 	
 	<resultMap type="kr.or.ddit.vo.artist.ArtistVO" id="artistMap">
 		<id property="artNo" column="ART_NO"/>
 		<result property="artNo" column="ART_NO"/>
		<result property="artGroupNo" column="ART_GROUP_NO"/>
		<result property="memUsername" column="MEM_USERNAME"/>
		<result property="artNm" column="ART_NM"/>
		<result property="artContent" column="ART_CONTENT"/>
		<result property="artRegDate" column="ART_REG_DATE"/>
		<result property="artModDate" column="ART_MOD_DATE"/>
		<result property="artProfileImg" column="ART_PROFILE_IMG"/>
		<result property="empUsername" column="EMP_USERNAME"/>
		<result property="artGroupNm" column="ART_GROUP_NM"/>
		<result property="artGroupDebutdate" column="ART_GROUP_DEBUTDATE"/>
		<result property="empName" column="empName"/>
		<result property="artDebutdate" column="ART_DEBUTDATE"/>
		
		<association property="memberVO" javaType="kr.or.ddit.vo.user.MemberVO">
			<id property="memUsername" column="mem_username"/>
	 		<result property="memStatCode" column="mem_stat_code" />
	 		<result property="memRegPath" column="mem_reg_path" />
	 		<result property="memNicknm" column="mem_nicknm" />
	 		<result property="memBirth" column="mem_birth" />
	 		<result property="memZipCode" column="mem_zip_code" />
	 		<result property="memAddress1" column="mem_address1" />
	 		<result property="memAddress2" column="mem_address2" />
	 		<result property="memModDate" column="mem_mod_date" />
	 		<result property="memRegDate" column="mem_reg_date" />
	 		
	 		<!-- 공통 VO(PeopleVO)  -->
	 		<result property="username" column="username" />
	 		<result property="password" column="password" />
	 		<result property="userTypeCode" column="user_type_code" />
	 		<result property="peoEnabled" column="peo_enabled" />
	 		<result property="peoFirstNm" column="peo_first_nm" />
	 		<result property="peoLastNm" column="peo_last_nm" />
	 		<result property="peoEmail" column="peo_email" />
	 		<result property="peoGender" column="peo_gender" />
	 		<result property="peoPhone" column="peo_phone" />
	 		<result property="peoName" column="peoName"/>
	 		<collection property="authList" resultMap="authMap" />
		</association>
 	</resultMap>
	 <resultMap type="PeopleAuthVO" id="authMap">
 		<result property="username" column="username" />
 		<result property="auth" column="auth" />
 	</resultMap>
 
 	<select id="getGroupList" parameterType="kr.or.ddit.vo.PaginationInfoVO" resultMap="artistGroupMap">
 		select b.*
		from (select a.*, row_number() over(order by a.art_group_no) as rnum
		  from
		        (SELECT
				  emp_username
				  , art_group_no
				  , art_group_nm
				  , art_group_content
				  , art_group_type_code
				  , art_group_profile_img
				  , art_group_reg_date
				  , art_group_mod_date
				  , art_group_debutdate
				  , (select peo_last_nm || peo_first_nm from people where username = emp_username) as empName
				FROM
				    artist_group
				WHERE 1=1
				and art_group_del_yn = 'N'
				<include refid="searchArtist" />
				ORDER BY art_group_no
				) a
			)b
		<![CDATA[
			where b.rnum >= #{startRow} and b.rnum <= #{endRow}
		]]>
    </select>
 	
 	<select id="getTotalRecord" parameterType="kr.or.ddit.vo.PaginationInfoVO" resultType="int">
 		select count(*)
 		from artist_group 
 		where 1=1
 		and art_group_del_yn = 'N'
 		<include refid="searchArtist" />
 	</select>
	
 </mapper>