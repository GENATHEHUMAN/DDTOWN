<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artist A - ì»¤ë®¤ë‹ˆí‹°</title>
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>
<%@ include file="../../modules/headerPart.jsp" %>
<style>
.membership-blur {
    filter: blur(5px);
    pointer-events: none;
}

.membership-only {
    position: relative;
}

.membership-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.membership-badge {
    background: #8a2be2;
    color: #fff;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.8em;
    margin-left: 5px;
}

.imgDiv{
	position :relative;
	width: 100px;
	height : 100px;
}

.imgDiv img{
	width : 100%;
	height : 100%
}

.imgDiv i{
	position : absolute;
	top : 5%;
	right: 5%; /* ì•„ì´ì½˜ì„ ì´ë¯¸ì§€ì˜ ê°€ë¡œ ì¤‘ì•™ì— ìœ„ì¹˜ */
    transform: translate(-10%, -10%); /* ì•„ì´ì½˜ì„ ì¤‘ì•™ì— ì •í™•íˆ ìœ„ì¹˜ */
    font-size: 1rem; /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì ˆ */
    color: white; /* ì•„ì´ì½˜ ìƒ‰ìƒ ì„¤ì • */
}
</style>
</head>
<body>
    
	<sec:authentication property="principal" var="user"/>
	
	    <c:out value="${user}"/>
    <div class="apt-main-layout">
        <div class="apt-container">
            <header class="apt-header">
                <div class="apt-header-avatar">
                    <div class="artist-avatar-placeholder">A</div><!-- ì•„í‹°ìŠ¤íŠ¸ ê·¸ë£¹ ì´ë¯¸ì§€ ë„£ì„ ì˜ˆì •-->
                </div>
                <div class="apt-header-info">
                    <h2><c:out value="${artistGroupVO.artGroupNm }" /> <span style="font-size:0.7em; color: #888;">(ì•„í‹°ìŠ¤íŠ¸)</span></h2>
                    <div class="artist-stats">
                        <span><c:out value="${artistGroupVO.communityVO.totalArtist }"/>ëª…</span> &bull; <span><fmt:formatNumber value="${artistGroupVO.communityVO.totalFan }" pattern="#,###"/></span> íŒ¬
                    </div>
                </div>
                <div class="apt-header-actions">
                <button class="btn-apt-action following" id="followToggleBtn">
                    <span class="follow-icon">âœ”</span> íŒ”ë¡œì‰ </button>
                <button class="btn-apt-action">ğŸ”” ì•Œë¦¼ ì„¤ì •</button>
            </div>
            </header>

            <ul class="nav apt-tabs" id="comuTab" role="tabList">
            	<li class="nav-item" role="presentation">
            		<button class="tab-item active" id="artistPost" data-bs-toggle="tab" data-bs-target="#artistPostList" type="button" role="tab" aria-controls="artistPostList" aria-selected="true">ì•„í‹°ìŠ¤íŠ¸</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="fanPost" data-bs-toggle="tab" data-bs-target="#fanPostList" type="button" role="tab" aria-controls="fanPostList" aria-selected="false">íŒ¬</button>
            	</li>
            	<li class="nav-item" role="presentation" >
            		<button class="tab-item" id="live" data-bs-toggle="tab" data-bs-target="#liveList" type="button" role="tab" aria-controls="liveList" aria-selected="false">ë¼ì´ë¸Œ</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="schedule" data-bs-toggle="tab" data-bs-target="#scheduleList" type="button" role="tab" aria-controls="scheduleList" aria-selected="false">ìŠ¤ì¼€ì¤„</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="noticeApt" data-bs-toggle="tab" data-bs-target="#noticeAptList" type="button" role="tab" aria-controls="noticeAptList" aria-selected="false">ê³µì§€ì‚¬í•­</button>
            	</li>
            </ul>

            <main class="apt-content-area">
                <div class="tab-pane show active" id="artistPostList" role="tabpanel" aria-labelledby="artistPost">
                    <div id="artistFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">
		            	<form action="/community/gate/${artistGroupVO.artGroupNo }/apt" id="artistSearchForm" method="get">
			            	<input type="hidden" id="comuArtGroupNo" value="${artistGroupVO.artGroupNo }" />
			            	<input type="hidden" name="artistTabYn" value="true" />
			            	<input type="hidden" name="searchType" id="searchType" />
	                        <input type="text" name="searchWord" id="artistFeedSearchInput" value="${communityVO.searchWord }" placeholder="ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œê¸€ ê²€ìƒ‰ (ì œëª©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
	                        <input type="button" id="searchFormBtn" class="btn btn-primary" value="ê²€ìƒ‰" />
	                        <sec:authorize access="hasAnyRole('MEMBER','MEMBERSHIP','EMPLOYEE','ADMIN')">
	                        	<input type="radio" class="btn-check" name="artistNm" id="all" value="" />
	                        	<label class="btn btn-outline-primary" for="all">ì „ì²´</label>
		                        <c:forEach items="${artistGroupVO.artistList }" var="artist">
		                        	<input type="radio" class="btn-check" name="artistNm" id="${artist.artNm }" value="${artist.memUsername }" <c:if test="${not empty communityVO.searchType and communityVO.searchType eq artist.memUsername}">checked</c:if>/>
		                        	<label class="btn btn-outline-primary" for="${artist.artNm }">${artist.artNm }</label>
		                        </c:forEach>
	                        </sec:authorize>
		            	</form>
                    </div>
                    
                    <form id="postForm">
                    	<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
	                    <input type="checkbox" id="memberShipYn" name="memberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼"/>
	                    <label for="memberShipYn">ë©¤ë²„ì‹­ì „ìš©</label>
	                    <input type="text" id="comuPostTitle" name="comuPostTitle" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;" />
	                    <div id="editor">
	                    </div>
	                    <div class="text-right pt-2">
							<span class="pt-1"><span class="cmt-sub-size">0</span>/1000</span> 
						</div>
	                    <div id="imgArea"></div>
	                    <button type="button" id="artistPostInsertBtn">ì €ì¥</button>
	                    <button type="button" id="test">í…ŒìŠ¤íŠ¸</button>
                    </form>
                    
                    <div id="artistFeedList">
                    	<c:forEach items="${artistPostVO }" var="post" varStatus="v">
                    		<c:if test="${post.boardTypeCode eq 'ARTIST_BOARD'}">
                    			<div class="feed-item" data-post-id="${post.comuPostNo }">
                    				<div class="feed-item-header">
                    					<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="${post.writerProfile.comuProfileImg }"></div>
                    					<div class="author-info">
                    						<span class="author-name" style="color:'#8a2be2';">${post.writerProfile.comuNicknm}</span>
                    						<span class="post-time">
	                    						<c:choose>
	                    							<c:when test="${post.comuPostRegDate ne post.comuPostModDate }">
			                    						<fmt:formatDate value="${post.comuPostModDate }" pattern="MM.dd. HH:mm"/>(ìˆ˜ì •ë¨)
	                    							</c:when>
	                    							<c:otherwise>
	                    								<fmt:formatDate value="${post.comuPostRegDate }" pattern="MM.dd. HH:mm"/>
	                    							</c:otherwise>
	                    						</c:choose>
                    						</span>
                    						<c:if test="${post.memberShipYn }">
                    							<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>
                    						</c:if>
                    					</div>
                    					<div class="post-options">
                    						<button class="post-options-btn" style="background:none;border:none;font-size:1.2em;cursor:pointer;">â€¢â€¢â€¢</button>
			                                <div class="post-options-menu" style="position:absolute;right:0;top:30px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);z-index:10;min-width:90px;">
				                                <sec:authorize access="hasRole('ARTIST')">
				                                	<c:if test="${user.name eq post.writerProfile.memUsername }">
					           							<div class="post-option-item" id="edit" data-postNum="${v.index }">ìˆ˜ì •</div>
					           							<div class="post-option-item" data-action="delete">ì‚­ì œ</div>
				                                	</c:if>
				                                </sec:authorize>
			                                </div>
                    					</div>
                    				</div>
                    				<div class="feed-item-content<c:if test="${post.memberShipYn }">membership-blur</c:if>" style="<c:if test="${post.memberShipYn }">'position:relative;'</c:if>">
                    					<form id="postForm${v.index }" data-postNum=${v.index }>
	                    					<div class="post-title" style="font-weight:bold;font-size:1.1em;margin-bottom:5px;">${post.comuPostTitle}</div>
	                   						<c:if test="${not empty post.postFiles }">
		                    					<div class="post-img">
	                    							<c:forEach items="${post.postFiles }" var="file">
	                    								<img src="${file.webPath }">
	                    							</c:forEach>
		                    					</div>
	                   						</c:if>
	                    					<div class="post-text" id="artistPostViewer">${post.comuPostContent}</div>
                    					</form>
                    					<form id="editPostForm${v.index }" style="display:none" data-postNum=${v.index }>
	                    					<input type="text"  name="comuPostTitle" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;" value="${post.comuPostTitle}"/>
	                    					<c:if test="${not empty post.postFiles }">
	                    						<div class="editPost-img">
	                    							<c:forEach items="${post.postFiles }" var="file">
	                    								<img src="${file.webPath }">
	                    								<i class="bi bi-x-lg"></i>
	                    							</c:forEach>
		                    					</div>
	                    					</c:if>
	                    					<div id="editPostEditor">${post.comuPostContent}</div>
	                    					<input type="checkbox" id="editMemberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼" <c:if test="${post.memberShipYn }">checked</c:if>/>
	                    					<label for="editMemberShipYn">ë©¤ë²„ì‹­ì „ìš©</label>
	                    					<input type="button" id="editUpdateBtn" value="ìˆ˜ì •" />
	                    					<input type="button" id="editCancelBtn" value="ì·¨ì†Œ" /> 
                    					</form>
                    				</div>
                    				<div class="feed-item-actions">
			                            <button class="action-btn comment-toggle-btn">ğŸ’¬ ëŒ“ê¸€ <span class="count"><c:out value="${post.comuPostReplyCount }" /></span></button>
			                        </div>
			                        <div class="comments-wrapper" style="display:block;">
			                        	<div class="comment-form-container">
			                        		<textarea class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                    						<button class="btn-submit-comment" disabled>ë“±ë¡</button>
			                        	</div>
			                        	<div class="comment-list">
			                        		<c:forEach items="${post.comuPostReplyList }" var="reply">
				                        		<div class="comment-content">
				                        			<span class="comment-author-name"><c:out value="${reply.replyMember.comuNicknm }"/></span>
	                                				<p class="comment-text"><c:out value="${reply.comuReplyContent }"/></p>
				                        		</div>
			                        		</c:forEach>
			                        	</div>
			                        </div>
                    			</div>
                    		</c:if>
                    	</c:forEach>
                    </div>
                </div>
                <div class="tab-pane" id="fanPostList" role="tabpanel" aria-labelledby="fanPost">ddd</div>
                
				<div class="tab-pane" id="liveList" role="tabpanel" aria-labelledby="live">..d</div>
				
				<div class="tab-pane" id="scheduleList" role="tabpanel" aria-labelledby="schedule">.dd</div>
				<div class="tab-pane" id="noticeAptList" role="tabpanel" aria-labelledby="noticeApt">....</div>

            </main>
        </div>




<!-- /////////////////////////////////////////////////////////////////////////////////////////////////////// -->






        <aside class="apt-sidebar">
            <div class="sidebar-widget apt-level-widget">
                <h3>APT í˜„í™©</h3>
                <div class="apt-floor-display" id="aptFloorDisplay">123ì¸µ APT</div>
                <div class="fan-count-tooltip-wrapper"> <p class="fan-count-display">íŒ¬ <span id="sidebarFanCountApprox">ì•½ 12.3ë§Œ</span> ëª…</p> <span class="fan-count-tooltip" id="sidebarFanCountExact">123,456ëª…</span> </div>
            </div>

            <div class="sidebar-widget membership-widget">
                <div class="membership-icon">ğŸ›¡ï¸</div>
                <h3>Membership</h3>
                <p>ì§€ê¸ˆ ë©¤ë²„ì‹­ì— ê°€ì…í•˜ê³  Artist Aì˜ íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”.</p>
                <button class="btn-join-membership" id="openMembershipModalBtn">
                    ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° <span class="arrow">&gt;</span>
                </button>
            </div>

             <!-- ë§ˆì´ í”„ë¡œí•„ ì˜ì—­ ì¶”ê°€ -->
             <div class="sidebar-widget my-profile-widget" style="margin-bottom: 20px; text-align: center; cursor: pointer;">
             	<div>
             		<button type="button" class="btn btn-outline-primary" id="registProfileBtn">í”„ë¡œí•„ ë§Œë“¤ê¸°</button>
             	</div>
                <div style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; overflow: hidden; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                </div>
                <p id="myProfileNickname" style="margin-top: 8px; font-weight: bold; font-size: 1.1em;">ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„</p>
            </div>

        </aside>
    </div>

    <div id="footer-placeholder"></div>

     <div class="modal-overlay" id="membershipModalOverlay" style="display: none;">
        <div class="modal-content membership-modal">
            <button class="modal-close-btn" id="closeMembershipModalBtn" title="ë‹«ê¸°">&times;</button>
            <div class="modal-header">
                <h2>Artist A OFFICIAL MEMBERSHIP</h2>
                <p class="membership-duration">ì´ìš© ê¸°ê°„: ê²°ì œì¼ë¡œë¶€í„° 30ì¼</p>
            </div>
            <div class="modal-body">
                <div class="membership-main-image">
                </div>
                <h3>ì£¼ìš” í˜œíƒ ì•ˆë‚´</h3>
                <ul class="modal-benefits-list">
                    <li>âœ”ï¸ ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥ (ì¼ë¶€ ë¸”ëŸ¬ ì²˜ë¦¬ëœ ì½˜í…ì¸  ì¦‰ì‹œ í•´ì œ!)</li>
                    <li>ğŸ—“ï¸ APT ë©”ì¸ ìƒë‹¨ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ êµ¬ë…ì¼ D-Day í™•ì¸</li>
                    <li>ğŸ¤ ì½˜ì„œíŠ¸/íŒ¬ë¯¸íŒ… ì„ ì˜ˆë§¤ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ ì°¸ì—¬ ê¸°íšŒ</li>
                    <li>ğŸ í•œì •íŒ ë©¤ë²„ì‹­ í‚¤íŠ¸ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë˜ëŠ” ë“±ê¸‰ì— ë”°ë¼)</li>
                </ul>

                <h3>ì´ìš© ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</h3>
                <ul class="modal-notes-list">
                    <li>ë³¸ ë©¤ë²„ì‹­ì€ ë¹„ìš©ì„ ì„ ì§€ë¶ˆí•˜ì—¬ ì´ìš©í•˜ëŠ” ìœ ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</li>
                    <li>ë©¤ë²„ì‹­ì€ ì•„í‹°ìŠ¤íŠ¸(ì†”ë¡œ, ê·¸ë£¹)ë³„ë¡œ ë³„ë„ ìš´ì˜ë˜ë©°, ë³¸ ë©¤ë²„ì‹­ì€ [Artist A] ì „ìš©ì…ë‹ˆë‹¤.</li>
                    <li>ê·¸ë£¹ ë‚´ ì†”ë¡œ í™œë™ ë©¤ë²„ ë°œìƒ ì‹œ, í•´ë‹¹ ë©¤ë²„ì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³„ë„ ìƒì„±/ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ìì„¸í•œ ë‚´ìš©ì€ êµ¬ë§¤ í˜ì´ì§€ì˜ ì•½ê´€ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <div class="membership-price">â‚©30,000 <span class="vat-notice">(VAT í¬í•¨)</span></div>
                <button class="btn-modal-purchase" id="goToPurchasePageBtn">ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>

     <!-- ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë²„ë ˆì´ -->
    <div id="communityOverlay" class="d-flex p-2 align-items-center fixed-bottom" 
    	style="height:50px; bottom: 0px; width:100%; background-color: rgba(0,0,0,0.7); border-radius: 5px;">
        <div class="community-overlay-bg"></div>
        <span style="color: #fff;">ì»¤ë®¤ë‹ˆí‹° íŒ”ë¡œìš°ë¥¼ í•´ì„œ ëª¨ë“  ì»¨í…ì¸ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”</span>
        <button class="community-join-btn" id="followBtn" style="margin-left: auto; color:#fff">íŒ”ë¡œìš°í•˜ê¸°</button>
    </div> 

    <!-- ë‹‰ë„¤ì„ ì…ë ¥ ëª¨ë‹¬ -->
    <div class="modal fade" id="commProfileModal" tabindex="-1" aria-labelledby="nicknameModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="commProfileModalLabel">ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                	<div class="mb-3 d-flex justify-content-center align-items-center">
                        <div class="profile-img-box" id="previewImgBox" style="border-radius: 50%;">
                            <img alt="í”„ë¡œí•„ì´ë¯¸ì§€" src="${pageContext.request.contextPath}/upload/profile/base/defaultImg.png" id="previewImg" width="100px" height="100px">
                        </div>
                	</div>
                    <div class="mb-3">
                        <label for="comuNicknm" class="form-label">ë‹‰ë„¤ì„</label>
                        <input type="text" class="form-control" id="comuNicknm" name="comuNicknm" maxlength="12" placeholder="12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”">
                    </div>

                    <div class="mb-3">
                        <label for="imgFile" class="form-label">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                        <input class="form-control" type="file" id="imgFile" name="imgFile" accept="image/*">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                    <button type="button" class="btn btn-primary" id="profileSubmitBtn">ì™„ë£Œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- DM ëª¨ë‹¬ì´ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="weverse-dm-modal-container"></div>

    <!-- DM ì—´ê¸° ë²„íŠ¼ (ì›í•˜ëŠ” ê³³ì— ë°°ì¹˜) -->
    <button onclick="openWeverseDM()">DM ì—´ê¸°</button>

<script>

$(function(){
	
	let files = new Map();	// ì—…ë¡œë“œí•œ íŒŒì¼ ë‹´ì„ ê°ì²´
	let fileNum = 0;		// ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ìˆœë²ˆ
	
	// ì´ë¯¸ì§€ ì˜ì—­ ê°€ì ¸ì˜¤ê¸°
	let area = $("#imgArea"); 
	
	// ê¸€ ë“±ë¡ editor
	const editor = new toastui.Editor({
        el: document.querySelector('#editor'),
        height: '200px',
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical',
        hideModeSwitch : true,
        language : 'ko-KR',
        toolbarItems: [
        	['heading','bold','italic','strike'],
        	['hr','ul','ol','indent','outdent'],
        	['image','link'],
        ],
        hooks : {
        	addImageBlobHook(blob, callback){
        		
        		files.set(fileNum.toString(),blob);
        		
        		console.log("blob : ", blob);
        		
        		let reader = new FileReader();
        		reader.onload = function(e){
        			html = `
    					<div class="imgDiv">
    						<img src="\${e.target.result}"  data-fileNum='\${fileNum}' >
    								<i class="bi bi-x-lg"></i>
    						</img>
    						
    					</div>
						`;
   					$("#imgArea").append(html);
	        		fileNum++;
        		}
        		reader.readAsDataURL(blob);
        		
        	}
        },
      });
	
	
	// ì´ë¯¸ì§€ ì‚­ì œ ì‹œ files mapì— ì‚­ì œ
	area.on("click","i",function(){
		let pr = $(this).parent("div").remove();
		let cur = $(this).parent("div").children('img')[0].dataset.filenum;
		
		files.delete(cur);
		
	});
	
	// ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œê¸€ ë‚´ìš© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
	let artistPostList = document.querySelectorAll("#artistPostViewer");
	
	// ê°€ì ¸ì˜¨ ê²Œì‹œê¸€ ë‚´ìš© ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜ë³µë¬¸ì„ ëŒë ¤ì„œ viewer ì„¤ì •
	artistPostList.forEach((v, i) => {
		
		let content = v.dataset.markdown
		
		const viewr = new toastui.Editor.factory({
			el: v,
			viewer : true,
			initialValue : content,
		});
	})
	
	
	// ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#searchFormBtn").on("click",function(){
		console.log($("#artistSearchForm").find("input:checked").val());
		let selectArtist = $("#artistSearchForm").find("input:checked").val();
		$("#searchType").val(selectArtist);
		
		$("#artistSearchForm").submit();
	});
	
	// ì•„í‹°ìŠ¤íŠ¸ê°€ ê¸€ ë“±ë¡ ì‹œ
	$("#artistPostInsertBtn").on("click",function(){
		let artGroupNo = $("#comuArtGroupNo").val()		// ì»¤ë®¤ë‹ˆí‹° ì•„í‹°ìŠ¤íŠ¸ ë²ˆí˜¸
		let comuPostTitle = $("#comuPostTitle").val();	// ë“±ë¡í•  ì œëª©
		let comuPostContent = editor.getHTML();			// ë“±ë¡í•  ë‚´ìš©
		let artistTabYn = true;							// ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œë¬¼ ì—¬ë¶€
		let fileList = [];								// ì´ë¯¸ì§€ íŒŒì¼ ë¦¬ìŠ¤íŠ¸
		files.forEach((v,k,map) => {		
			fileList.push(v);							// íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì— mapì— ë‹´ê²¨ìˆëŠ” ê°’ ë„£ê¸°	
		})
		
		console.log(fileList);
		
		let memberShipYn = $("#memberShipYn").is(':checked');	// ë©¤ë²„ì‹­ ì „ìš© ê²Œì‹œë¬¼ ì—¬ë¶€
		
		console.log("ì»¤ë®¤ë‹ˆí‹° ë²ˆí˜¸ : " , artGroupNo);
		console.log("ì œëª© : ", comuPostTitle);
		console.log("ë‚´ìš© : ", comuPostContent);
		console.log("íŒŒì¼ë¦¬ìŠ¤íŠ¸ : ", fileList);
		console.log("ë©¤ë²„ì‹­ ì „ìš© ì—¬ë¶€ : ", memberShipYn);
		console.log("ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œë¬¼ì¸ì§€ : ",artistTabYn );
		
		let data = new FormData();
		data.append("artGroupNo",artGroupNo);
		data.append("comuPostTitle",comuPostTitle);
		data.append("comuPostContent",comuPostContent);
		data.append("memberShipYn", memberShipYn);
		data.append("artistTabYn", artistTabYn);
		if(fileList != null && fileList.length > 0){
			for(let i=0; i<fileList.length; i++){
				data.append("files", fileList[i]);
			}
		}
		$.ajax({
			url : '/community/gate/insertPost',
			type : 'post',
			data : data,
			contentType : false,
			processData : false,
			success : function(res){
				console.log(res);
				if(res == "OK"){
					location.href = "/community/gate/" + artGroupNo + "/apt";
				}
			},
			error : function(error){
				console.log(error.status);
			},
			beforeSend : function(xhr) {
		        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
		    }
		});
		
	});
	
	// ê¸€ ì‘ì„±í•  ì‹œ ê¸€ì ê¸¸ì´ ì œí•œ
	editor.on("keyup",function(){
		contentLengthCheck(editor);
	});
	
	
	// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ 
	let editBtnList = document.querySelectorAll("#edit");		// ëª¨ë“  ìˆ˜ì • ë²„íŠ¼ì„ nodeListë¡œ ê°€ì ¸ì˜´
	editBtnList.forEach(div => {								
		div.addEventListener("click",function(e){				// div íƒœê·¸ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë„˜ 
			let a = e.target.dataset.postnum;					// í´ë¦­í•œ divì— ì €ì¥ë˜ì–´ìˆëŠ” postNumì„ ê°€ì ¸ì™€ postFormìˆœë²ˆ ê³¼ editPostFormìˆœë²ˆì˜ ìŠ¤íƒ€ì¼ displayë¥¼ ë³€ê²½í•´ì¤Œìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ ë³€ê²½í•´ì¤Œ
			console.log(a);
			console.log($("#postForm" + a));
			$("#postForm" + a).attr("style","display:none");
			$("#editPostForm" + a).attr("style","display:block");
			console.log("form : ", $("#editPostForm" + a));
		});
	})
	
	/* let updateEditorArea = document.querySelectorAll("#editPostEditor");
	updateEditorArea.forEach((v, i) => {
		console.log(v);
		// ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œë¬¼ ìˆ˜ì • editor
		const updateEditor = new toastui.Editor({
			el : v,
			height: '200px',
			initialEditType: 'wysiwyg',
			previewStyle: 'vertical',
	        hideModeSwitch : true,
	        language : 'ko-KR',
	        toolbarItems: [
	        	['heading','bold','italic','strike'],
	        	['hr','ul','ol','indent','outdent'],
	        	['image','link'],
	        ],
		})
	}) */
	
	$("#test").on("click",function(){
		console.log($("#artistPostViewer").html());
		let a = document.querySelectorAll(".toastui-editor-contents");
		console.log(a);
	});


	
	// íŒ”ë¡œìš°ë²„íŠ¼
	let followBtn = $("#followBtn");	// ì˜¤ë²„ë ˆì´ìª½ íŒ”ë¡œìš° ë²„íŠ¼
	let followToggleBtn = $("#followToggleBtn"); // íŒ”ë¡œìš° ë²„íŠ¼
	let commProfileModal = $("#commProfileModal"); // ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ ìƒì„± ëª¨ë‹¬
	let previewImgBox = $("#previewImgBox"); //ë¯¸ë¦¬ë³´ê¸°ì´ë¯¸ì§€ë°•ìŠ¤
	
	followBtn.on("click",function(){
		commProfileModal.modal("show");
		joinCommunity();
	});
	
	function joinCommunity(){
		let artGroupNo = "${artistGroupVO.artGroupNo}";
		$.ajax({
			url : `/api/community/joinApt/\${artGroupNo}`,
			type : "post",
			beforeSend : function(xhr){
				xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
			},
			success : function(res){
				console.log(res);
			}
		});
	}
	});
function contentLengthCheck(ele){
	let size = ele.getMarkdown().length;
	let text = ele.getMarkdown();
	
	if(size > 1000){
		alert("ê¸€ ì‘ì„±ì€ 1000ì ì´ìƒì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		let subText = text.substring(0,1000);	
		ele.setMarkdown(subText, true);
		$("#editor").parents("#postForm").find(".cmt-sub-size").text(subText.length);
		return false;
	}
	
	$("#editor").parent("#postForm").find(".cmt-sub-size").text(size);
}


</script>
</body>
</html>