<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 관리자 - 아티스트 계정 관리</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/emp_common.css">
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/emp_portal_style.css">
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/group-management.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
    <style>
        /* admin_portal.css에 정의된 스타일을 최대한 활용합니다. */
        /* 아티스트명 링크 스타일 */
        .artist-name-link {
            font-weight: 500;
            color: #007bff; /* 기본 링크 색상 */
            text-decoration: none;
        }
        .artist-name-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>

        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
			<c:set var="title" value="새 그룹 등록"/>
			<c:if test="${status eq 'U' }">
				<c:set var="title" value="그룹 수정"/>
			</c:if>
			<c:set var="text" value="등록"/>
			<c:if test="${status eq 'U' }">
				<c:set var="text" value="수정"/>
			</c:if>
            <main class="emp-content">
                <section class="ea-section">
                    <div class="ea-section-header">
                        <h2>${title }</h2>
                    </div>
                    <form class="ea-form" id="newGroupForm">
                        <div class="form-group">
                            <label for="groupName">그룹명</label>
                            <input type="text" id="artGroupNm" name="artGroupNm" value="${artistGroupVO.artGroupNm }" required>
                        </div>
                        <div class="form-group">
                            <label for="groupDebutDate">데뷔일</label>
                            <input type="text" id="artGroupDebutdate" name="artGroupDebutdate" value="${artistGroupVO.artGroupDebutdate }">
                        </div>
                        <div class="form-group" id="autocomplete">
                            <label for="groupManager">담당자 등록</label>
                            <input type="text" id="empUsername" name="empUsername" value="${artistGroupVO.empUsername }">
                        </div>
                        <div class="form-group">
		                    <fieldset>
		                        <legend style="font-weight: bold; padding: 0; margin-bottom: 5px; border: 0; display: block; width:auto;">활동유형:</legend>
		                        <div class="radio-options-wrapper" style="display: block; margin-left: 0px; margin-top: 5px;">
		                            <label class="radio-label" for="artGroupTypeGroup" style="margin-right: 15px; cursor:pointer; font-weight:normal;">
		                                <input type="radio" name="artGroupTypeCode" value="AGTC001" id="artGroupTypeGroup" <c:if test="${artistGroupVO.artGroupTypeCode eq 'AGTC001'}">checked</c:if>>그룹
		                            </label>
		                            <label class="radio-label" for="artGroupTypeSolo" style="cursor:pointer; font-weight:normal;">
		                                <input type="radio" name="artGroupTypeCode" value="AGTC002" id="artGroupTypeSolo" <c:if test="${artistGroupVO.artGroupTypeCode eq 'AGTC002'}">checked</c:if>>솔로
		                            </label>
		                        </div>
		                    </fieldset>
		                </div>
                        <div class="form-group">
                           	<fieldset>
		                        <legend class="form-label" style="font-weight: bold; padding: 0; margin-bottom: 10px; border: 0; display: block; width: auto;">그룹멤버</legend>
		                        <div id="selectedMembersContainer" class="members-container" style="margin-bottom: 10px; min-height: 40px; border: 1px solid #ddd; padding: 8px; border-radius: 4px;">
	                            	<c:forEach items="${artistGroupVO.artistList }" var="artist">
	                            		<p class="member-tag" >
											${artist.artNm }
											<span class="remove-member-btn">
												<i class="bi bi-x"></i>
											</span>
										</p>
	                            	</c:forEach>
		                        </div>
		                        <div class="input-group-for-member-add" style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px;">
		                            <select id="artistSelect" class="form-control" style="flex-grow: 1;">
		                                <option value="">-- 아티스트 선택 --</option>
		                                <c:forEach items="${artistList}" var="artist">
		                                    <option value="${artist.artNo}">${artist.artNm }</option>
		                                </c:forEach>
		                            </select>
		                            <button type="button" id="addMemberBtn" class="action-button" style="white-space: nowrap;">멤버 추가</button>
		                        </div>
		                        <input type="hidden" id="memberArtNosInput" name="memberArtNos" />
		                    </fieldset>
                        </div>
                        
                        <div class="form-group">
                           	<fieldset>
		                        <legend class="form-label" style="font-weight: bold; padding: 0; margin-bottom: 10px; border: 0; display: block; width: auto;">앨범등록</legend>
		                        <div id="selectedMembersContainer" class="members-container" style="margin-bottom: 10px; min-height: 40px; border: 1px solid #ddd; padding: 8px; border-radius: 4px;">
	                            	<c:forEach items="${artistGroupVO.albumList}" var="album">
	                            		<p class="member-tag" >
											${album.albumNm }
											<span class="remove-member-btn">
												<i class="bi bi-x"></i>
											</span>
										</p>
	                            	</c:forEach>
		                        </div>
		                        <div class="input-group-for-member-add" style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px;">
		                            <select id="artistSelect" class="form-control" style="flex-grow: 1;">
		                                <option value="">-- 앨범 선택 --</option>
		                                <c:forEach items="${albumList}" var="album">
		                                    <option value="${album.albumNo}">${album.albumNm }</option>
		                                </c:forEach>
		                            </select>
		                            <button type="button" id="addMemberBtn" class="action-button" style="white-space: nowrap;">앨범 추가</button>
		                        </div>
		                        <input type="hidden" id="memberArtNosInput" name="memberArtNos" />
		                    </fieldset>
                        </div>
                        <div class="form-group">
                            <label for="groupProfileImage">프로필 이미지</label>
                            <input type="file" id="groupProfileImage" name="profileImage" accept="image/*" class="ea-form-control" style="width:auto; height:auto; padding: 5px;">
                            <img id="groupProfileImagePreview" src="" alt="">
                        </div>
                        <div class="ea-form-actions">
                        	<c:set var="url" value="/admin/community/group/list"/>
                        	<c:if test="${status eq 'U' }">
	                        	<c:set var="url" value="/admin/community/group/detail?artGroupNo=${artistGroupVO.artGroupNo }"/>
                        	</c:if>
                            <a href="${url }" class="ea-btn outline">취소</a>
                            <button type="button" class="ea-btn primary" id="registerGroupBtn">${text }</button>
                        </div>
                    </form>
                    <!-- 그룹 멤버 추가 모달 -->
                    <div id="artistModal" class="modal">
                        <div class="modal-content">
                            <h3>아티스트 선택</h3>
                            <div class="artist-list-modal" id="artistListInModal"></div>
                            <button type="button" class="ea-btn" id="closeArtistModalBtn">닫기</button>
                        </div>
                    </div>
                    <!-- 앨범 등록 모달 -->
                    <div id="albumModal" class="modal">
                        <div class="modal-content">
                            <h3>앨범 등록</h3>
                            <label>앨범명 <input type="text" id="albumName"></label><br>
                            <label>발매일 <input type="date" id="albumReleaseDate"></label><br>
                            <label>커버 이미지 <input type="file" id="albumCover"></label><br>
                            <button type="button" class="ea-btn" id="saveAlbumBtn">등록</button>
                            <button type="button" class="ea-btn" id="closeAlbumModalBtn">닫기</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <footer class="emp-footer">
            <p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (관리자 전용)</p>
        </footer>
    </div>
</body>
<%@ include file="../../modules/footerPart.jsp" %>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
	const navItemsWithSubmenu = document.querySelectorAll('.emp-sidebar .emp-nav-item.has-submenu');
	navItemsWithSubmenu.forEach(item => {
		const arrow = item.querySelector('.submenu-arrow');
		item.addEventListener('click', function(event) {
			if (this.getAttribute('href') === '#') {
			    event.preventDefault();
			}
			const parentLi = this.parentElement;
			const submenu = this.nextElementSibling;
		
			if (submenu && submenu.classList.contains('emp-submenu')) {
				const parentUl = parentLi.parentElement;
				if (parentUl) {
					Array.from(parentUl.children).forEach(siblingLi => {
						if (siblingLi !== parentLi) {
							const siblingSubmenuControl = siblingLi.querySelector('.emp-nav-item.has-submenu.open');
							if (siblingSubmenuControl) {
								const siblingSubmenu = siblingSubmenuControl.nextElementSibling;
								siblingSubmenuControl.classList.remove('open');
								if (siblingSubmenu && siblingSubmenu.classList.contains('emp-submenu')) {
								    siblingSubmenu.style.display = 'none';
								}
								const siblingArrow = siblingSubmenuControl.querySelector('.submenu-arrow');
								if (siblingArrow) siblingArrow.style.transform = 'rotate(0deg)';
							}
						}
					});
				}
			}
		
			this.classList.toggle('open');
			if (submenu && submenu.classList.contains('emp-submenu')) {
				submenu.style.display = this.classList.contains('open') ? 'block' : 'none';
				if (arrow) arrow.style.transform = this.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
			}
		});
	});
	
	let groupProfileImage = document.getElementById("groupProfileImage");
	let groupProfileImagePreview = document.getElementById("groupProfileImagePreview");
	
	groupProfileImage.addEventListener("change",function(){
		const file = this.files[0];
		if(!file.type.startsWith("image/")){
			sweetAlert("error","사진 파일만 입력해주세요");
			this.value = null;
			groupProfileImagePreview.src = "";
			return false;
		}
		const maxSize = 2 * 1024 * 1024;
		if(file.size > maxSize){
			sweetAlert("error", "2MB 미만의 사진만 등록해주세요");
			this.value = "";
			groupProfileImagePreview.src = "";
			return false;
		}
		
		const reader = new FileReader();
		reader.onload = function(e){
			console.dir(e)
			groupProfileImagePreview.src = e.target.result
		}
		reader.readAsDataURL(file);
		
	});
	
	
});
</script>
</html>